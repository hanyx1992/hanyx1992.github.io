<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title>OCMock æºç å­¦ä¹ ç¬”è®°</title>
      <link href="/2019/06/30/learn-ocmock/"/>
      <url>/2019/06/30/learn-ocmock/</url>
      <content type="html"><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>ä½¿ç”¨ XCTest + OCMock å†™å•å…ƒæµ‹è¯•ä¹Ÿæœ‰ä¸€æ®µæ—¶é—´äº†. ä¸€ç›´æ²¡äº†è§£ OCMock åˆ°åº•æ˜¯æ€ä¹ˆå®ç°çš„, æ‰€ä»¥å°±æƒ³æ‰¾ä¸ªæ—¶é—´è¯»è¯»æºç , æ­å¼€ OCMock çš„ç¥ç§˜é¢çº±. åœ¨é˜…è¯»æºç æ—¶å‘ç°æ¯”è¾ƒæ ¸å¿ƒçš„æœºåˆ¶å°±æ˜¯ NSProxy + æ¶ˆæ¯è½¬å‘, æ‰€ä»¥åœ¨çœ‹æºç ä¹‹å‰, å…ˆç®€å•å¤ä¹ ä¸€ä¸‹ç›¸å…³çŸ¥è¯†.</p><h2 id="æ¶ˆæ¯è½¬å‘"><a href="#æ¶ˆæ¯è½¬å‘" class="headerlink" title="æ¶ˆæ¯è½¬å‘"></a>æ¶ˆæ¯è½¬å‘</h2><p>å…ˆæ¥çœ‹çœ‹æ¶ˆæ¯è½¬å‘, Objective-C çš„æ¶ˆæ¯æœºåˆ¶å°±ä¸èµ˜è¿°äº†, åœ¨ <code>objc_msgSend</code> æ—¶, å¦‚æœå¯¹è±¡çš„å’Œå…¶çˆ¶ç±»ä¸€ç›´åˆ°æ ¹ç±»éƒ½æ²¡æœ‰åœ¨æ–¹æ³•ç¼“å­˜å’Œæ–¹æ³•åˆ—è¡¨ä¸­æ‰¾åˆ°å¯¹åº”çš„æ–¹æ³•å°±ä¼šå‘ç”Ÿè¿™æ ·çš„é”™è¯¯: <code>unrecognized selector sent to instance</code>, ä½†æ˜¯åœ¨å´©æºƒå‰, ä¼šæœ‰æ¶ˆæ¯è½¬å‘çš„æœºåˆ¶æ¥å°è¯•æŒ½æ•‘.</p><p><img src="http://ww2.sinaimg.cn/large/006tNc79ly1g4jm5tdlpij313w0u0aly.jpg" alt="æ¶ˆæ¯è½¬å‘ç®€åŒ–æ•´ç†"></p><p>ç¬¬ä¸€æ­¥, é¦–å…ˆä¼šè°ƒç”¨ <code>forwardingTargetForSelector:</code> æ–¹æ³•è·å–ä¸€ä¸ªå¯ä»¥å¤„ç†è¯¥ <code>Selector</code> çš„å¯¹è±¡. å¯¹è¯¥å¯¹è±¡é‡æ–°è¿›è¡Œå‘é€æ¶ˆæ¯, å¦‚æœè¿”å›ä¸º <code>nil</code>, åˆ™èµ°ç¬¬äºŒæ­¥.</p><p>ç¬¬äºŒæ­¥, è°ƒç”¨ <code>methodSignatureForSelector:</code> æ–¹æ³•æ¥è·å¾—æ–¹æ³•ç­¾å <code>NSMethodSignature</code>, åŒ…å« <code>Selector</code> å’Œ å‚æ•°çš„ä¿¡æ¯, ç”¨äºç”Ÿæˆ <code>NSInvocation</code>, å¦‚æœè¿”å›ä¸º <code>nil</code>, åˆ™æŠ›å‡º <code>doesNotRecognizeSelector</code> å¼‚å¸¸.</p><p>ç¬¬ä¸‰æ­¥, è°ƒç”¨ <code>forwardInvocation:</code> å¯¹ <code>NSInvocation</code> è¿›è¡Œå¤„ç†, å¦‚æœæœ¬èº«, çˆ¶ç±»ä¸€ç›´åˆ°æ ¹ç±»éƒ½æ²¡æœ‰å¤„ç†, åˆ™è¿˜æ˜¯ä¼šæŠ›å‡º <code>doesNotRecognizeSelector</code> å¼‚å¸¸.</p><p>ç®€å•æ•´ç†æ¶ˆæ¯è½¬å‘åˆ°æœºåˆ¶å°±æ˜¯è¿™æ ·, æ›´æ·±çš„åŸç†æ¨èé˜…è¯»æ¨è§ç‰å¤§ç¥çš„è¿™ç¯‡æ–‡ç« : <a href="http://yulingtianxia.com/blog/2016/06/15/Objective-C-Message-Sending-and-Forwarding/" target="_blank" rel="noopener">Objective-C æ¶ˆæ¯å‘é€ä¸è½¬å‘æœºåˆ¶åŸç†</a>.</p><h2 id="NSProxy"><a href="#NSProxy" class="headerlink" title="NSProxy"></a>NSProxy</h2><blockquote><p>An abstract superclass defining an API for objects that act as stand-ins for other objects or for objects that donâ€™t exist yet.</p></blockquote><p>åœ¨æ–‡æ¡£ä¸­çš„è§£é‡Šæ˜¯è¿™æ ·çš„, NSProxy æ˜¯ä¸€ä¸ªæŠ½è±¡çš„çˆ¶ç±»(è¯´æ ¹ç±»æ›´ä¸ºåˆé€‚), ç”¨äºå®šä¹‰å¯¹è±¡çš„ API, å¯ä»¥å……å½“å…¶ä»–å¯¹è±¡æˆ–è€…å·²ç»ä¸å­˜åœ¨çš„å¯¹è±¡çš„æ›¿èº«. </p><p>åœ¨ iOS ä¸­çš„æ ¹ç±»æ˜¯ NSObject å’Œ NSProxy, NSObject å³æ˜¯æ ¹ç±»ä¹Ÿæ˜¯åè®®, NSProxy ä¹Ÿå®ç°äº†è¯¥åè®®, å¹¶ä¸”ä½œä¸ºä¸€ä¸ªæŠ½è±¡ç±», å®ƒå¹¶ä¸æä¾›åˆå§‹åŒ–æ–¹æ³•, å¦‚æœæ¥æ”¶åˆ°å®ƒæ²¡æœ‰å“åº”çš„æ¶ˆæ¯æ—¶ä¼šæŠ›å‡ºå¼‚å¸¸, æ‰€ä»¥, éœ€è¦ä½¿ç”¨å­ç±»ç»§æ‰¿å®ç°åˆå§‹åŒ–æ–¹æ³•, ç„¶åé€šè¿‡é‡å†™ <code>forwardInvocation:</code> å’Œ<code>methodSignatureForSelector:</code> æ–¹æ³•æ¥å¤„ç†å®ƒæœ¬èº«æœªå®ç°çš„æ¶ˆæ¯å¤„ç†.</p><p>è¿™é‡Œåˆ—å‡ºä¸¤ä¸ªç»å¸¸ä¼šä½¿ç”¨åˆ°çš„å° Tips.</p><h3 id="YYWeakProxy"><a href="#YYWeakProxy" class="headerlink" title="YYWeakProxy"></a>YYWeakProxy</h3><p><code>YYWeakProxy</code> æ˜¯ <code>YYKit</code> ä¸­æä¾›çš„å·¥å…·, ç”¨äºæŒæœ‰ä¸€ä¸ª <code>weak</code> å¯¹è±¡, é€šå¸¸ç”¨æ¥è§£å†³ <code>NSTimer</code> å’Œ <code>CADisplayLink</code> å¾ªç¯å¼•ç”¨çš„é—®é¢˜. æ¯”å¦‚æˆ‘ä»¬ç»å¸¸ä¼šåœ¨å¯¹è±¡å†…ä½¿ç”¨ <code>NSTimer</code>, è¯¥å¯¹è±¡å¼ºå¼•ç”¨ç€ <code>NSTimer</code>, è€Œè¯¥å¯¹è±¡åœ¨ä½œä¸º <code>target</code> æ—¶å°±åˆä¼šè¢« <code>NSTimer</code> å¼ºå¼•ç”¨ç€, å°±æ„æˆäº†å¾ªç¯å¼•ç”¨, å¯¼è‡´éƒ½æ— æ³•é‡Šæ”¾.</p><p><a href="https://github.com/ibireme/YYKit/blob/4e1bd1cfcdb3331244b219cbd37cc9b1ccb62b7a/YYKit/Utility/YYWeakProxy.m" target="_blank" rel="noopener">ç‚¹è¿™é‡ŒæŸ¥çœ‹å…¨éƒ¨æºç </a></p><p>ç®€å•ä»‹ç»ä¸€ä¸‹ <code>YYWeakProxy</code> æ˜¯å¦‚ä½•å®ç°çš„, é¦–å…ˆä½¿ç”¨åˆå§‹åŒ–æ–¹æ³•, å¼±å¼•ç”¨ç€ <code>target</code> å¯¹è±¡.</p><pre><code class="objc">- (instancetype)initWithTarget:(id)target {    _target = target;    return self;}</code></pre><p>é€šè¿‡å®ç° <code>forwardingTargetForSelector:</code> æ–¹æ³•æ¥å°†æ¶ˆæ¯è½¬å‘ç»™ <code>_taget</code>, å……å½“äº†æ¡¥æ¢, ç ´é™¤äº†å¦‚ <code>NSTimer</code> å¯¹ <code>target</code> çš„å¼ºå¼•ç”¨.</p><pre><code class="objc">- (id)forwardingTargetForSelector:(SEL)selector {    return _target;}</code></pre><p>ç„¶åè¿™é‡Œåˆå¦å¤–å®ç°äº†è¿™ä¸¤ä¸ªæ–¹æ³•, è¿™æ˜¯ä¸ºäº†ä»€ä¹ˆå‘¢?</p><pre><code class="objc">- (void)forwardInvocation:(NSInvocation *)invocation {    void *null = NULL;    [invocation setReturnValue:&amp;null];}- (NSMethodSignature *)methodSignatureForSelector:(SEL)selector {    return [NSObject instanceMethodSignatureForSelector:@selector(init)];}</code></pre><p>å› ä¸º <code>target</code> æ˜¯å¼±å¼•ç”¨çš„, å¦‚æœé‡Šæ”¾äº†, å°±ä¼šè¢«ç½®ä¸º <code>nil</code>, è½¬å‘æ–¹æ³• <code>forwardingTargetForSelector:</code> å°±ç›¸å½“äºè¿”å›äº† <code>nil</code>, é‚£ä¹ˆæ²¡æœ‰åŠæ³•å¤„ç†æ¶ˆæ¯, åˆ™ä¼šå¯¼è‡´å‘ç”Ÿå´©æºƒ. </p><p>æ‰€ä»¥è¿™é‡Œå°±æ˜¯éšä¾¿è¿”å›äº†ä¸€ä¸ªæ–¹æ³•ç­¾å, ç›´æ¥è¿”å› <code>NSObject</code> çš„ <code>init</code> çš„æ–¹æ³•ç­¾å, <code>invocation</code> å¹¶æœªè°ƒç”¨ <code>invoke</code> åªæ˜¯è¿”å› <code>nil</code>, ç›¸å½“äºæ­¤æ—¶å‘é€ä»€ä¹ˆæ¶ˆæ¯éƒ½ä¼šè¿”å› <code>nil</code>, ä¸ä¼šå´©æºƒ.</p><h3 id="å®ç°å¤šç»§æ‰¿"><a href="#å®ç°å¤šç»§æ‰¿" class="headerlink" title="å®ç°å¤šç»§æ‰¿"></a>å®ç°å¤šç»§æ‰¿</h3><p>åœ¨ objc ä¸­æ˜¯ä¸èƒ½å¤šç»§æ‰¿çš„, ä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ NSProxy æ¥æ¨¡æ‹Ÿå¤šç»§æ‰¿çš„æ•ˆæœ, å…¶å®å°†ä¸Šé¢çš„ä¾‹å­çš„ <code>target</code> å˜æˆä¸€ä¸ªæ•°ç»„æ¥æŒæœ‰å¤šä¸ª <code>target</code>.</p><p>ç„¶åå°†æ–¹æ³•æŒ‰ç…§ <code>respondsToSelector:</code> è°èƒ½å¤„ç†, æ¥è½¬å‘ç»™å„ä¸ª <code>target</code> å°±å¯ä»¥å®ç°å¤šç»§æ‰¿äº†, æ¯”è¾ƒç®€å•, è¿™é‡Œç”¨æœ€ç®€å•çš„æ–¹æ³•å®ç°å¦‚ä¸‹:</p><pre><code class="objc">- (id)forwardingTargetForSelector:(SEL)selector {    __block id target = nil;    [self.tagets enumerateObjectsUsingBlock:^(id  _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) {        if ([obj respondsToSelector:selector]) {            target = obj;            *stop = YES;        }    }];    return target;}</code></pre><p>æ¥ä¸‹æ¥è¿›å…¥æ­£é¢˜, æ¥å¼€å§‹çœ‹ä¸€ä¸‹ <code>OCMock</code> çš„æ ¸å¿ƒæºç å®ç°.</p><h2 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h2><p>æˆ‘å‡†å¤‡ä»ä¸€ä¸ªç»å¸¸ä¼šç”¨åˆ°çš„ä¾‹å­æ¥ä¸€ç‚¹ä¸€ç‚¹é˜…è¯» OCMock çš„æºç å®ç°.</p><p>åœ¨å•å…ƒæµ‹è¯•ä¸­, ç»å¸¸éœ€è¦å±è”½æ‰å¤–ç•Œå› ç´ çš„å¹²æ‰°, æ¯”å¦‚æ–¹æ³•ä¸­ä¾èµ–çš„å¤–éƒ¨æ–¹æ³•çš„ç»“æœ, åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­, å¤§é‡çš„ä½¿ç”¨äº†ä¸‹å‘çš„å¼€å…³é…ç½®, æ¯”å¦‚ä¸‹é¢è¿™è¡Œä»£ç æ¥åˆ¤æ–­æ˜¯å¦å¼€å¯æŸä¸ªåŠŸèƒ½.</p><pre><code class="objc">BOOL enableXX = [[RemoteConfig sharedRemoteConfig] enableXXFeature];</code></pre><p>ä½¿ç”¨ OCMock æ¥ Mock è¯¥ç»“æœçš„æ–¹å¼å¦‚ä¸‹:</p><pre><code class="objc">// Setupid configMock = OCMClassMock([RemoteConfig class]);OCMStub([configMock sharedRemoteConfig]).andReturn(configMock);OCMStub([configMock enableXXFeature]).andReturn(YES);// Assert...// Teardown[configMock stopMocking];</code></pre><p>ç¬¬ä¸€è¡Œåˆ›å»ºä¸€ä¸ª <code>RemoteConfig</code> ç±»çš„ mock å¯¹è±¡, å‘½åä¸º <code>configMock</code>;</p><p>ç¬¬äºŒè¡Œ mock æ‰ <code>[configMock sharedRemoteConfig]</code> çš„<strong>ç±»æ–¹æ³•</strong>, å¹¶ä¸” <code>andReturn</code> æ·»åŠ è¿”å›å€¼ä¸ºè¯¥ mock å¯¹è±¡. è¿™æ ·é€šè¿‡ <code>[RemoteConfig sharedRemoteConfig]</code> å°±å¯ä»¥æ°¸è¿œè¿”å›ä¸€ä¸ª mock çš„å¯¹è±¡, æ¥ä¸‹æ¥åªè¦åœ¨å¯¹è¿™ä¸ª mock çš„å¯¹è±¡çš„ <code>enableXXFeature</code> æ–¹æ³•æ·»åŠ ä¸€ä¸ªè¿”å›å€¼å°±å¯ä»¥å®ç° mock å¼€å…³äº†;</p><p>ç¬¬ä¸‰è¡Œ, mock æ‰ <code>[configMock enableXXFeature]</code> çš„<strong>å®ä¾‹æ–¹æ³•</strong>å¹¶ä¸” <code>andReturn</code> æ·»åŠ è¿”å›å€¼æ’å®šä¸º <code>YES</code>.</p><p><code>OCMock</code> ä½¿ç”¨äº†å¤§é‡çš„å®å®šä¹‰, é‚£ä¹ˆå°±é€šè¿‡ <code>Xcode</code> æä¾›çš„ <code>Preprocess</code> çš„åŠŸèƒ½æ¥ä¸€æ­¥ä¸€æ­¥çœ‹çœ‹åˆ°åº•æ˜¯æ€ä¹ˆå›äº‹å§.</p><h2 id="OCMClassMock"><a href="#OCMClassMock" class="headerlink" title="OCMClassMock"></a>OCMClassMock</h2><p>ç¬¬ä¸€è¡Œ, <code>OCMClassMock</code> å®å±•å¼€åå¦‚ä¸‹:</p><pre><code class="objc">id configMock = [OCMockObject niceMockForClass:[RemoteConfig class]];</code></pre><p>è¿™ä¸ª <code>OCMockObject</code> å°±æ˜¯æˆ‘ä»¬åˆšåˆšè¯´åˆ°çš„ <code>NSProxy</code> çš„ä¸€ä¸ªå­ç±», æ¥å®ç°æ¶ˆæ¯è½¬å‘, <code>niceMockForClass</code> å…¶å®å°±æ˜¯è°ƒç”¨äº†</p><pre><code class="objc">+ (id)mockForClass:(Class)aClass {    return [[[OCClassMockObject alloc] initWithClass:aClass] autorelease];}</code></pre><p>åªä¸è¿‡è®¾ç½®äº†ä¸€ä¸ª <code>isNice</code> çš„å®ä¾‹å˜é‡, å¹¶ä¸”æ ‡è®°ä¸º <code>YES</code>, è¿™ä¸ªä¸å½±å“æ ¸å¿ƒåŸç†çš„ç†è§£, ç®€å•è¯´ä¸€ä¸‹, OCMock ä¸­ä½¿ç”¨ <code>OCMStrictClassMock</code> å¯ä»¥è¿›è¡Œä¸€ä¸ªä¸¥æ ¼çš„ mock, å¦‚æœè°ƒç”¨æ²¡æœ‰ <code>Stub</code> ä½çš„æ–¹æ³•æ—¶, å°±ä¼šå´©æºƒ, è€Œè¿™ä¸ª <code>OCMClassMock</code> å°±æ˜¯ <code>nice</code> çš„, æ²¡æœ‰ <code>Stub</code> çš„æ–¹æ³•ä¼šè¿›è¡Œä¸€ä¸‹ä¿æŠ¤, ä¸ä¼šäº§ç”Ÿå´©æºƒ, æ¯”è¾ƒ <code>nice</code>, æˆ‘ä»¬æ¯”è¾ƒå¸¸ç”¨åˆ°çš„å°±æ˜¯æ¯”è¾ƒ <code>nice</code> çš„ <code>OCMClassMock</code>.</p><h2 id="OCMStub"><a href="#OCMStub" class="headerlink" title="OCMStub"></a>OCMStub</h2><p>æ•´ä¸ª <code>OCMStub</code> æ˜¯æœ€æ ¸å¿ƒçš„ç‚¹, å…¶ä»–çš„ <code>Expect</code> å’Œ <code>Reject</code> åŸç†å¤§éƒ½ä¸€è‡´, ä¸€ç‚¹ä¸€ç‚¹çœ‹.</p><h3 id="enableXXFeature"><a href="#enableXXFeature" class="headerlink" title="enableXXFeature"></a>enableXXFeature</h3><h4 id="å±•å¼€"><a href="#å±•å¼€" class="headerlink" title="å±•å¼€"></a>å±•å¼€</h4><pre><code>OCMStub([configMock enableXXFeature]).andReturn(YES);</code></pre><p>å…ˆä»è¿™è¡Œä»£ç æ¥çœ‹èµ·, å…ˆçœ‹ OCMStub çš„å±•å¼€, æˆ‘ç¨å¾®æ•´ç†äº†ä¸€ä¸‹, ä»£ç å¦‚ä¸‹:</p><pre><code class="objc">({    [OCMMacroState beginStubMacro];    OCMStubRecorder *recorder = ((void *)0);    @try{        [configMock enableXXFeature];    } @finally {        recorder = [OCMMacroState endStubMacro];    }    recorder;});</code></pre><p>å…¶ä¸­ä¸Šä¸‹ä¸¤ä¸ª <code>begin</code> å’Œ <code>end</code> çš„æ–¹æ³•å°±æ˜¯ä¸ºäº†å¢åŠ ä¸€ä¸ª <code>OCMStubRecorder</code> æ ‡è®°, å¹¶ä¸”å­˜æ”¾åœ¨å½“å‰çº¿ç¨‹çš„å­—å…¸ä¸­. ä»£ç å¦‚ä¸‹:</p><pre><code class="objc">+ (void)beginStubMacro {    OCMStubRecorder *recorder = [[[OCMStubRecorder alloc] init] autorelease];    OCMMacroState *macroState = [[OCMMacroState alloc] initWithRecorder:recorder];    [NSThread currentThread].threadDictionary[OCMGlobalStateKey] = macroState;    [macroState release];}+ (OCMStubRecorder *)endStubMacro {    NSMutableDictionary *threadDictionary = [NSThread currentThread].threadDictionary;    OCMMacroState *globalState = threadDictionary[OCMGlobalStateKey];    OCMStubRecorder *recorder = [(OCMStubRecorder *)[globalState recorder] retain];    [threadDictionary removeObjectForKey:OCMGlobalStateKey];    return [recorder autorelease];}</code></pre><h4 id="Stub"><a href="#Stub" class="headerlink" title="Stub"></a>Stub</h4><p>å…³é”®åœ¨ä¸­é—´ä¸€è¡Œ <code>[configMock enableXXFeature]</code> çš„è°ƒç”¨, <strong>å­˜åœ¨è¿™ä¸ª <code>OCMStubRecorder</code> æ ‡è®°æ—¶</strong>, ä¼šåœ¨æ¶ˆæ¯è½¬å‘çš„ <code>forwardingTargetForSelector:</code> è¿™ä¸ªæ–¹æ³•ä¸­è¿›è¡Œå¤„ç†, è®°å½• <code>configMock</code> å¯¹è±¡çš„åŒæ—¶, è¿”å›è¿™ä¸ª <code>recorder</code> å¯¹è±¡è¿›è¡Œå¤„ç†.</p><pre><code class="objc">- (id)forwardingTargetForSelector:(SEL)aSelector {    if([OCMMacroState globalState] != nil) {        OCMRecorder *recorder = [[OCMMacroState globalState] recorder];        [recorder setMockObject:self];        return recorder;    }    return nil;}</code></pre><p>æ‰€ä»¥ä¾¿ç†è§£äº†ä¸Šé¢ä¸ºä»€ä¹ˆè¦å°† <code>recorder</code> å¯¹è±¡æ”¾å…¥å½“å‰çº¿ç¨‹çš„å­—å…¸ä¸­, æ˜¯ä¸ºäº†åŒæ ·æ˜¯è¿™æ ·ä¸€è¡Œä»£ç  <code>[configMock enableXXFeature]</code>, åœ¨æ˜¯å¦æœ‰ <code>recorder</code> æ—¶, å¯ä»¥æœ‰ä¸¤ç§æˆªç„¶ä¸åŒçš„å¤„ç†è·¯çº¿, å¾ˆæ˜¯å·§å¦™. å³åœ¨å®šä¹‰ <code>Stub</code> æ—¶, å¯ä»¥äº¤ç»™ <code>recorder</code> å»å¤„ç†, è€Œåœ¨çœŸæ­£è°ƒç”¨è¯¥æ–¹æ³•æ—¶, å¯ä»¥ç”±è¿™ä¸ª mock çš„å¯¹è±¡æŒ‰ç…§æ¶ˆæ¯è½¬å‘æ¥ä¸‹æ¥çš„æµç¨‹å¤„ç†.</p><p>è¿™ä¸ª <code>recorder</code> å¯¹è±¡æ˜¯ <code>OCMStubRecorder</code> ç±»å‹, ç»§æ‰¿è‡ª <code>OCMRecorder</code>, è€Œ <code>OCMRecorder</code> åˆç»§æ‰¿è‡ª <code>NSProxy</code>. æ‰€ä»¥è¿™ä¸ª <code>recorder</code> ä¹Ÿéœ€è¦å¤„ç†æ¶ˆæ¯è½¬å‘æœºåˆ¶. </p><p><code>recorder</code> åœ¨ <code>methodSignatureForSelector:</code> ä¸­, å…ˆæŒ‰ç…§å®ä¾‹æ–¹æ³•å»è·å– mock å¯¹è±¡çš„æ–¹æ³•ç­¾å, å¦‚æœæ²¡æœ‰çš„è¯å†æŒ‰ç…§ç±»æ–¹æ³•å»è·å–æ–¹æ³•ç­¾å, å¦‚æœè·å–åˆ°åˆ™åœ¨ <code>invocationMatcher</code> è®°å½•æ ‡è®°ä¸€ä¸‹, æ˜¯<code>ç±»æ–¹æ³•</code>, è¿˜æ˜¯æ²¡è·å–åˆ°å°±ä¼šè¿”å› <code>nil</code> äº†, æŒ‰ç…§æ¶ˆæ¯è½¬å‘æœºåˆ¶, åˆ™ä¼šæŠ›å‡º <code>doesNotRecognizeSelector</code> å¼‚å¸¸.</p><pre><code class="objc">- (NSMethodSignature *)methodSignatureForSelector:(SEL)aSelector {    if([invocationMatcher recordedAsClassMethod])        return [mockedClass methodSignatureForSelector:aSelector];    NSMethodSignature *signature = [mockObject methodSignatureForSelector:aSelector];    if(signature == nil) {       if([mockedClass respondsToSelector:aSelector]) {            // æ ‡è®°ä¸€ä¸‹è¯æ˜è¯¥ Selector æ˜¯ç±»æ–¹æ³•, æ ‡è®°åˆ° invocationMatcher ä¸Š            [self classMethod];            // é‡æ–°è°ƒç”¨è¿™ä¸ªæ–¹æ³•å–æ–¹æ³•å‰é¢, è¿™æ ·å°±ä¼šè¢«å‰ä¸¤è¡Œè¿”å›            signature = [self methodSignatureForSelector:aSelector];        }    }    return signature;}</code></pre><p>å‰é¢ä¸¤è¡Œçš„æ„æ€æ˜¯å¦‚æœå·²ç»è¢«æ ‡è®°ä¸ºç±»æ–¹æ³•äº†, åˆ™ç›´æ¥è¿”å›ç±»æ–¹æ³•çš„æ–¹æ³•ç­¾å.</p><p>å†æ¥çœ‹ <code>forwardInvocation:</code> å¤„ç†çš„æ–¹æ³•, æˆ‘æŒ‰ç…§ç»§æ‰¿å…³ç³»æ•´ç†äº†ä¸€ä¸‹æ–¹ä¾¿é˜…è¯»:</p><pre><code class="objc">- (void)forwardInvocation:(NSInvocation *)anInvocation {    [anInvocation setTarget:nil];    [invocationMatcher setInvocation:anInvocation];    [mockObject addStub:invocationMatcher];}</code></pre><p>å…¶ç›®çš„å°±æ˜¯é€šè¿‡ <code>setTarget:nil</code> æ¥ç¦æ­¢è¿™ä¸ª <code>invocation</code> è°ƒç”¨, ç”¨ <code>invocationMatcher</code> æ¥è®°å½•å¹¶ä¸”ç®¡ç†ä¸€ä¸‹è¿™ä¸ª <code>invocation</code>, ç„¶åæŠŠè¿™ä¸ª <code>invocationMatcher</code> ä¼ é€’ç»™ <code>mockObject</code> å°±æ˜¯æˆ‘ä»¬ä¸Šé¢è®°å½•è¿‡çš„ <code>configMock</code> å¯¹è±¡.</p><p>åœ¨ <code>addStub:</code> æ–¹æ³•ä¸­, å¦‚æœæ˜¯å®ä¾‹æ–¹æ³•åªæ˜¯å°†è¿™ä¸ª <code>invocationMatcher</code> ä¿å­˜åˆ°äº†ä¸€ä¸ªæ•°ç»„ä¸­, å¦‚æœæ˜¯ç±»æ–¹æ³•ç­‰ä¸‹å†çœ‹ Stub <code>sharedRemoteConfig</code> è¿™ä¸ªç±»æ–¹æ³•æ—¶å†çœ‹.</p><p>è¿™æ ·æ•´ä¸ª <code>OCMStub</code> çš„è¿‡ç¨‹å°±ç†è§£äº†. åœ¨ç®€å•æ•´ç†ä¸€ä¸‹å¯¹è±¡é—´çš„å…³ç³», æ–¹ä¾¿ç†è§£.</p><p><img src="http://ww4.sinaimg.cn/large/006tNc79ly1g4jm74vmjjj31bw07stac.jpg" alt="å¯¹è±¡é—´å…³ç³»-1"></p><p>mock å¯¹è±¡æŒæœ‰ä¸€ä¸ª <code>invocationMatcher</code> å¯¹è±¡çš„æ•°ç»„, æ¯ä¸€ä¸ª <code>invocationMatcher</code> å¯¹è±¡è¡¨ç¤ºä¸€æ¬¡çš„ Stub(æˆ–è€…æ˜¯ Expect ç­‰), è¿˜è®°å½•ç€è¯¥æ–¹æ³•æ˜¯ä¸ªç±»æ–¹æ³•è¿˜æ˜¯å®ä¾‹æ–¹æ³•.</p><p>æ¯ä¸€ä¸ª <code>invocationMatcher</code> æŒæœ‰ <code>invocation</code> å¯¹è±¡, ç”¨äºè¿›è¡Œåœ¨è°ƒç”¨çš„æ—¶å€™, å’Œè°ƒç”¨çš„ <code>invocation</code> è¿›è¡ŒåŒ¹é…, ä»¥åŠå‚æ•°æ ¡éªŒç­‰é€»è¾‘.</p><p>åœ¨ Stub æµç¨‹ä¸­, è¿™ä¸ª <code>recorder</code> å¯¹è±¡ç›¸å½“äºä¸€ä¸ªæµç¨‹ç®¡ç†è€…, è®°å½•äº†è¯¥æµç¨‹çš„ä¿¡æ¯, å† Stub è¯­å¥å®Œæ•´ç»“æŸå, å…¶å®å°±è¢«é‡Šæ”¾äº†, åé¢åœ¨çœ‹.</p><h4 id="andReturn"><a href="#andReturn" class="headerlink" title="andReturn"></a>andReturn</h4><p><code>OCMStub</code> å®é™…ä¸Šæ˜¯è¿”å›äº† <code>OCMStubRecorder</code> è¿™ä¸ªå¯¹è±¡. åœ¨è¿™ä¸ªå¯¹è±¡ä¸­è®°å½•éœ€è¦çš„æ–¹æ³•è¿”å›å€¼. å±•å¼€åå¦‚ä¸‹:</p><pre><code class="objc">recorder._andReturn(({    __typeof__((YES)) _val = ((YES));    NSValue *_nsval = [NSValue value:&amp;_val withObjCType:@encode(__typeof__(_val))];    if (OCMIsObjectType(@encode(__typeof(_val)))) {        objc_setAssociatedObject(_nsval, &quot;OCMAssociatedBoxedValue&quot;, *(__unsafe_unretained id *) (void *) &amp;_val, OBJC_ASSOCIATION_RETAIN);    }    _nsval;}));</code></pre><p>è¡¥å……è¯´æ˜ä¸€ä¸‹, <code>@encode</code> æ˜¯ä¸€ä¸ªç¼–è¯‘å™¨æŒ‡ä»¤, è¿”å›ä¸€ä¸ªç±»å‹å†…éƒ¨è¿›è¡Œè¡¨ç¤ºçš„å­—ç¬¦ä¸², æ¯”å¦‚è¿™é‡Œä½¿ç”¨çš„ <code>YES</code> æ˜¯ <code>BOOL</code> ç±»å‹, å†…éƒ¨å­—ç¬¦ä¸²è¡¨ç¤ºå°±æ˜¯ <code>&quot;B&quot;</code>, æ›´æ·±å…¥çš„, æ›´æ–¹ä¾¿å¯¹ç±»å‹è¿›è¡Œåˆ¤æ–­å’Œå¤„ç†, å…³äº <code>@encode</code> æ¨èé˜…è¯»è¿™ç¯‡æ–‡ç« </p><p><a href="https://nshipster.cn/type-encodings/" target="_blank" rel="noopener">Type Encodings</a></p><p>æ‰€ä»¥, æ•´ä½“é€»è¾‘ç®€å•æ¥è¯´å®é™…ä¸Šå°±æ˜¯å°†è¿™ä¸ªè¿”å›å€¼é€šè¿‡ <code>NSValue</code> è¿›è¡ŒåŒ…è£…, å¯ä»¥ç†è§£ä¸º</p><pre><code class="objc">recorder._addReturn(_nsval);</code></pre><p>è¿™ä¸ª <code>_addReturn()</code> æ˜¯ä¸€ä¸ª <code>block</code>, ä¼ å…¥ä¸€ä¸ª <code>NSValue</code>, è¿”å›è‡ªèº«æ–¹ä¾¿é“¾å¼ç¼–å†™. æœ¬è´¨ä¸Šå°±æ˜¯æ ¹æ®è¿”å›å€¼çš„ç±»å‹, æ˜¯åŸºæœ¬ç±»å‹è¿˜æ˜¯å¯¹è±¡ä½¿ç”¨ä¸åŒçš„ <code>ValueProvider</code> è¿›è¡ŒåŒ…è£…. åŸºæœ¬ç±»å‹ä½¿ç”¨ <code>OCMBoxedReturnValueProvider</code>, å¯¹è±¡åˆ™ä½¿ç”¨ <code>OCMReturnValueProvider</code>.</p><p>åœ¨æ¥çœ‹åˆšåˆšçš„å¯¹è±¡é—´å…³ç³»:</p><p><img src="http://ww1.sinaimg.cn/large/006tNc79ly1g4jm7i2o5hj31dk0akgns.jpg" alt="å¯¹è±¡é—´å…³ç³»-2"></p><p>è¿™æ—¶å°±å¢åŠ äº† <code>ValueProviders</code> çš„é€»è¾‘, æ¯ä¸€ä¸ª <code>invocationMatcher</code> æŒæœ‰å¤šä¸ª. å› ä¸ºä¸ä»…ä»…å¯ä»¥ <code>andReturn</code> æŒ‡å®šè¿”å›å€¼, ä¾‹å¦‚è¿˜å¯ä»¥ <code>andDo</code> æŒ‡å®šä¸€ä¸ª <code>block</code><br>, åœ¨æ–¹æ³•è¢«è°ƒç”¨åæ‰§è¡Œç­‰ç­‰. ä¸è¿‡æ„Ÿè§‰ <code>OCMock</code> æ­¤å¤„çš„å¤„ç†è¿˜å¯ä»¥å†å®Œå–„ä¸€ä¸‹, è¿™äº›ç±»ä¼¼äºçš„ <code>ValueProviders</code> éƒ½éµä»ä¸€ä¸ª <code>ValueProviders</code> çš„åè®®, ç„¶ååè®®è¦æ±‚å®ç° <code>handleInvocation:</code>, ä¸è¿‡æ—¢ç„¶æ˜¯äººå®¶å†…éƒ¨çš„é€»è¾‘, ä¹Ÿæ— æ‰€è°“å•¦.</p><h4 id="è°ƒç”¨è¿‡ç¨‹"><a href="#è°ƒç”¨è¿‡ç¨‹" class="headerlink" title="è°ƒç”¨è¿‡ç¨‹"></a>è°ƒç”¨è¿‡ç¨‹</h4><p>è°ƒç”¨è¿‡ç¨‹ä¸­å®é™…ä¸Šæ˜¯æ²¡æœ‰ <code>recorder</code> çš„, åœ¨ <code>OCMStub</code> æ•´è¡Œä»£ç ç»“æŸåå°±è¢«é‡Šæ”¾å•¦. å¯¹è±¡å…³ç³»å°±å˜æˆè¿™æ ·äº†:</p><p><img src="http://ww3.sinaimg.cn/large/006tNc79ly1g4jm7vl1tkj31c608qtaf.jpg" alt="å¯¹è±¡é—´å…³ç³»-3"></p><p>çœŸæ­£è°ƒç”¨çš„æ˜¯å¯¹ <code>configMock</code> å³ <code>OCClassMockObject</code> è¿›è¡Œè°ƒç”¨å¦‚  <code>enableXXFeature</code> æ–¹æ³•çš„è¿‡ç¨‹å°±åƒå‰é¢è¯´è¿‡çš„, ç”±äºæ²¡æœ‰äº† <code>recorder</code>, <code>forwardingTargetForSelector:</code> ä¼šè¿”å› <code>nil</code> æ¥ä¸‹æ¥çš„æ¶ˆæ¯è½¬å‘æµç¨‹å›å»è·å–æ–¹æ³•ç­¾å, ç„¶ååœ¨ <code>forwardInvocation:</code> ä¸­å¤„ç†.</p><pre><code class="objc">- (void)forwardInvocation:(NSInvocation *)anInvocation {    @try    {        if([self handleInvocation:anInvocation] == NO)            [self handleUnRecordedInvocation:anInvocation];    } @catch(NSException *e) {        ...    }}</code></pre><p>æ ¸å¿ƒæ­¥éª¤åœ¨ <code>handleInvocation:</code> ä¸­, æ•´ç†å¦‚ä¸‹</p><pre><code class="objc">- (BOOL)handleInvocation:(NSInvocation *)anInvocation {// 1. è®°å½• `invocation` ç”¨äºå®ç° `Expect` çš„æ ¡éªŒé€»è¾‘    @synchronized(invocations) {        [anInvocation retainObjectArgumentsExcludingObject:self];        [invocations addObject:anInvocation];    }// 2. å–åˆšåˆš `addStub:` ä¸­è®°å½•çš„ `invocationMatcher` è¿›è¡ŒåŒ¹é…    OCMInvocationStub *stub = nil;    @synchronized(stubs) {        for(stub in stubs) {            if([stub matchesInvocation:anInvocation])                break;        }        [stub retain];    }    if(stub == nil)        return NO;// ...expectaion ç›¸å…³é€»è¾‘çœç•¥// 3. è¿™ä¸ª stub å°±æ˜¯ `invocationMatcher`, äº¤ç”±å®ƒå¤„ç†.    @try {        [stub handleInvocation:anInvocation];    } @finally {        [stub release];    }    return YES;}</code></pre><p><code>invocationMatcher</code> çš„å¤„ç†é€»è¾‘å¦‚ä¸‹:</p><pre><code class="objc">- (void)handleInvocation:(NSInvocation *)anInvocation {    NSMethodSignature *signature = [recordedInvocation methodSignature];    NSUInteger n = [signature numberOfArguments];    for(NSUInteger i = 2; i &lt; n; i++) {        id recordedArg = [recordedInvocation getArgumentAtIndexAsObject:i];        id passedArg = [anInvocation getArgumentAtIndexAsObject:i];        if([recordedArg isProxy])            continue;        if([recordedArg isKindOfClass:[NSValue class]])            recordedArg = [OCMArg resolveSpecialValues:recordedArg];        if(![recordedArg isKindOfClass:[OCMArgAction class]])            continue;        [recordedArg handleArgument:passedArg];    }// 4. é€šè¿‡è®°å½•çš„ `ValueProvider` äº¤ç»™å®ƒå»å¤„ç†    [invocationActions makeObjectsPerformSelector:@selector(handleInvocation:) withObject:anInvocation];}</code></pre><p>ä»¥ <code>OCMBoxedReturnValueProvider</code> ä¸ºä¾‹å­, å¤„ç†é€»è¾‘å¦‚ä¸‹</p><pre><code class="objc">- (void)handleInvocation:(NSInvocation *)anInvocation {    const char *returnType = [[anInvocation methodSignature] methodReturnType];    NSUInteger returnTypeSize = [[anInvocation methodSignature] methodReturnLength];    char valueBuffer[returnTypeSize];    NSValue *returnValueAsNSValue = (NSValue *)returnValue;// 5. å°†è¿”å›å€¼è®¾ç½®åˆ° `invocation` ä¸­ `[anInvocation setReturnValue:valueBuffer]`    if([self isMethodReturnType:returnType compatibleWithValueType:[returnValueAsNSValue objCType]]) {        [returnValueAsNSValue getValue:valueBuffer];        [anInvocation setReturnValue:valueBuffer];    } else if([returnValueAsNSValue getBytes:valueBuffer objCType:returnType]) {        [anInvocation setReturnValue:valueBuffer];    } else {        [NSException raise:NSInvalidArgumentException                    format:@&quot;Return value cannot be used for method; method signature declares &#39;%s&#39; but value is &#39;%s&#39;.&quot;, returnType, [returnValueAsNSValue objCType]];    }}</code></pre><p>è¿™æ ·å°±å®Œæˆäº†æ•´ä¸ªè°ƒç”¨è¿‡ç¨‹, å…¶ä¸­å¦‚æœæ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„æ–¹æ³•ç­‰ç­‰åŸå› åˆ™ä¼šåˆ¤æ–­å¦‚æœä¸æ˜¯ <code>isNice</code> åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸.</p><pre><code class="objc">- (void)handleUnRecordedInvocation:(NSInvocation *)anInvocation {    if(isNice == NO) {        [NSException raise:NSInternalInconsistencyException format:@&quot;%@: unexpected method invoked: %@ %@&quot;, [self description], [anInvocation invocationDescription], [self _stubDescriptions:NO]];    }}</code></pre><h3 id="sharedRemoteConfig"><a href="#sharedRemoteConfig" class="headerlink" title="sharedRemoteConfig"></a>sharedRemoteConfig</h3><p>çœ‹æ˜ç™½äº†å®ä¾‹æ–¹æ³•å®é™…ä¸Šæ˜¯é€šè¿‡ mock å¯¹è±¡è¿›è¡Œæ¶ˆæ¯è½¬å‘è¿›è¡Œå¤„ç†, ç„¶åè·å–æœŸæœ›çš„ç»“æœå¹¶è¿”å›çš„, é‚£ç±»æ–¹æ³•åˆæ˜¯å¦‚ä½•å®ç° mock çš„å‘¢?</p><p>å…³é”®å°±åœ¨åˆå§‹åŒ–æ—¶åšäº†ä¸€ä¸ªå‡†å¤‡å·¥ä½œ <code>prepareClassForClassMethodMocking</code> å’Œåˆšåˆš <code>addStub:</code> çš„å¤„ç†ä¸Š, ä¸€ä¸ªä¸€ä¸ªçœ‹.</p><p><code>prepareClassForClassMethodMocking</code> ç”¨æ³¨é‡Šæ€»ç»“æ•´ç†å¦‚ä¸‹:</p><pre><code class="objc">- (void)prepareClassForClassMethodMocking{// 1. æ’é™¤ä¸€äº›ä¼šå¼•èµ·é”™è¯¯çš„ç±» `NSString` / `NSArray` / `NSManagedObject`    if([[mockedClass class] isSubclassOfClass:[NSString class]] || [[mockedClass class] isSubclassOfClass:[NSArray class]])        return;    if([mockedClass isSubclassOfClass:objc_getClass(&quot;NSManagedObject&quot;)])        return;// 2. å¦‚æœä¹‹å‰æœ‰å¯¹è¯¥ç±»è¿›è¡Œçš„ mock æœªåœæ­¢åˆ™åœæ­¢    id otherMock = OCMGetAssociatedMockForClass(mockedClass, NO);    if(otherMock != nil)        [otherMock stopMockingClassMethods];    OCMSetAssociatedMockForClass(self, mockedClass);// 3. åŠ¨æ€åˆ›å»ºä¸€ä¸ª mock çš„ç±»(ä¾‹å­é‡Œæ˜¯ `RemoteConfig` )çš„å­ç±».    classCreatedForNewMetaClass = OCMCreateSubclass(mockedClass, mockedClass);    originalMetaClass = object_getClass(mockedClass);    id newMetaClass = object_getClass(classCreatedForNewMetaClass);// 4. åˆ›å»ºä¸€ä¸ªç©ºæ–¹æ³• `initializeForClassObject`, ä½œä¸ºå­ç±»çš„ `initialize` æ–¹æ³•, ä»¥ä¾¿æ’é™¤ mock ç±» `initialize` ä¸­ç‰¹æ®Šé€»è¾‘çš„å½±å“.    Method myDummyInitializeMethod = class_getInstanceMethod([self mockObjectClass], @selector(initializeForClassObject));    const char *initializeTypes = method_getTypeEncoding(myDummyInitializeMethod);    IMP myDummyInitializeIMP = method_getImplementation(myDummyInitializeMethod);    class_addMethod(newMetaClass, @selector(initialize), myDummyInitializeIMP, initializeTypes);// 5. `object_setClass(mockedClass, newMetaClass)` è®¾ç½® mock çš„ç±»çš„ Class ä¸ºæ–°åˆ›å»ºçš„å­ç±»çš„å…ƒç±».    object_setClass(mockedClass, newMetaClass);// 6. ä¸ºå…¶å…ƒç±»æ·»åŠ ä¸€ä¸ª `+ (void)forwardInvocation:` çš„å®ç° `forwardInvocationForClassObject:` ä»¥ä¾¿å¯ä»¥å¯¹ç±»æ–¹æ³•è¿›è¡Œæ¶ˆæ¯è½¬å‘.    Method myForwardMethod = class_getInstanceMethod([self mockObjectClass], @selector(forwardInvocationForClassObject:));    IMP myForwardIMP = method_getImplementation(myForwardMethod);    class_addMethod(newMetaClass, @selector(forwardInvocation:), myForwardIMP, method_getTypeEncoding(myForwardMethod));// 7. éå†è¯¥å…ƒç±»çš„æ–¹æ³•åˆ—è¡¨, å¯¹å…¶è‡ªèº«çš„æ–¹æ³•(é `NSObject` ç»§æ‰¿æ¥çš„) æ–¹æ³•æ‰§è¡Œ `setupForwarderForClassMethodSelector:`    NSArray *methodBlackList = @[@&quot;class&quot;, @&quot;forwardingTargetForSelector:&quot;, @&quot;methodSignatureForSelector:&quot;, @&quot;forwardInvocation:&quot;, @&quot;isBlock&quot;,            @&quot;instanceMethodForwarderForSelector:&quot;, @&quot;instanceMethodSignatureForSelector:&quot;];    [NSObject enumerateMethodsInClass:originalMetaClass usingBlock:^(Class cls, SEL sel) {        if((cls == object_getClass([NSObject class])) || (cls == [NSObject class]) || (cls == object_getClass(cls)))            return;        NSString *className = NSStringFromClass(cls);        NSString *selName = NSStringFromSelector(sel);        if(([className hasPrefix:@&quot;NS&quot;] || [className hasPrefix:@&quot;UI&quot;]) &amp;&amp;           ([selName hasPrefix:@&quot;_&quot;] || [selName hasSuffix:@&quot;_&quot;]))            return;        if([methodBlackList containsObject:selName])            return;        @try        {            [self setupForwarderForClassMethodSelector:sel];        }        @catch(NSException *e)        {            // ignore for now        }    }];}</code></pre><p><code>addStub:</code> çš„ç‰¹æ®Šé€»è¾‘å®é™…ä¸Šä¹Ÿæ˜¯æ‰§è¡Œäº† <code>setupForwarderForClassMethodSelector:</code>, è¯¥æ–¹æ³•è¿›è¡Œäº†æ’é‡. å®ç°å¦‚ä¸‹:</p><pre><code>- (void)setupForwarderForClassMethodSelector:(SEL)selector {    SEL aliasSelector = OCMAliasForOriginalSelector(selector);    if(class_getClassMethod(mockedClass, aliasSelector) != NULL)        return;    Method originalMethod = class_getClassMethod(mockedClass, selector);    IMP originalIMP = method_getImplementation(originalMethod);    const char *types = method_getTypeEncoding(originalMethod);    Class metaClass = object_getClass(mockedClass);    IMP forwarderIMP = [originalMetaClass instanceMethodForwarderForSelector:selector];    class_addMethod(metaClass, aliasSelector, originalIMP, types);    class_replaceMethod(metaClass, selector, forwarderIMP, types);}</code></pre><p>æ·»åŠ ä¸€ä¸ª <code>ocmock_replaced_åŸæ–¹æ³•å</code>, å°†è¯¥æ–¹æ³•æŒ‡å‘åŸæ¥æ–¹æ³•çš„æ–¹æ³•æŒ‡é’ˆ, å¹¶ä¸”å°†åŸæ¥æ–¹æ³•æŒ‡å‘åˆ°ä¸€ä¸ªä¸å­˜åœ¨çš„æ–¹æ³•ä¸Š, ä»¥ä¾¿å¯ä»¥èµ°æ¶ˆæ¯è½¬å‘, ä¹Ÿå°±æ˜¯åˆšåˆšæ·»åŠ çš„ <code>forwardInvocationForClassObject:</code></p><p>åœ¨ <code>forwardInvocationForClassObject:</code> æ–¹æ³•çœŸæ­£è°ƒç”¨æ—¶, ä¹Ÿæ˜¯è°ƒç”¨äº† <code>handleInvocation:</code>, ä¾¿ç»Ÿä¸€äº†æ¶ˆæ¯è½¬å‘çš„æµç¨‹, å®ç°äº†å¯¹ç±»æ–¹æ³•çš„ mock, ä¸åŒçš„æ˜¯å¯¹äºæ²¡æœ‰åŒ¹é…åˆ°çš„æ–¹æ³•ç›´æ¥æ‰§è¡Œäº† <code>invocation</code>, </p><h2 id="StopMocking"><a href="#StopMocking" class="headerlink" title="StopMocking"></a>StopMocking</h2><p>å¯¹äº <code>stopMocking</code> æ–¹æ³•çš„è°ƒç”¨ä¸æ˜¯å¿…é¡»çš„, åœ¨ mock å¯¹è±¡é‡Šæ”¾æ‰çš„æ—¶å€™ <code>dealloc</code> ä¸­ä¼šå…ˆè°ƒç”¨ <code>stopMocking</code>, å…¶ä¸­å¹²çš„äº‹å°±æ˜¯æ‰“æ‰«æˆ˜åœº, ç”±äºè®¾ç½®äº† mock å¯¹è±¡çš„å…ƒç±»ä¸ºåŠ¨æ€åˆ›å»ºçš„å­ç±»çš„å…ƒç±», æ‰€ä»¥éœ€è¦è¿˜åŸ</p><pre><code>object_setClass(mockedClass, originalMetaClass);</code></pre><p>ç„¶ååˆ é™¤æ‰åŠ¨æ€åˆ›å»ºçš„å­ç±», é€‰æ‹©ä½¿ç”¨åŠ¨æ€åˆ›å»ºçš„å­ç±»ä½œä¸ºå…ƒç±»å¹¶ä¸”æ·»åŠ æ–¹æ³•, è€Œä¸æ˜¯ç›´æ¥ä¿®æ”¹å…ƒç±»ä¸­çš„æ–¹æ³•, ä¹Ÿæ˜¯ä¸ºäº†æœ€åè¿˜åŸæ¯”è¾ƒå®¹æ˜“, ç›´æ¥é‡Šæ”¾æ‰å³å¯.</p><h2 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h2><p>å¯¹äºå…¶ä»–çš„ <code>OCMPartialMock</code> å’Œ <code>OCMProtocolMock</code> ç­‰, åŸºæœ¬åŸç†ä¹Ÿéƒ½ç›¸ä¼¼, å°±ä¸å†è®°å½•äº†, å…³äº OCMock å¤§ä½“çš„åŸç†åŸºæœ¬å¼„æ¸…æ¥šäº†, å…¶å®è¿˜æœ‰å¾ˆå¤šç»†èŠ‚è¿˜å¾—éšç€ç»§ç»­å­¦ä¹ å†åŠ æ·±ç†è§£, æ¬¢è¿äº¤æµğŸ‘ .</p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul><li><a href="https://github.com/erikdoe/ocmock" target="_blank" rel="noopener">OCMock</a></li><li><a href="http://yulingtianxia.com/blog/2016/06/15/Objective-C-Message-Sending-and-Forwarding/" target="_blank" rel="noopener">Objective-C æ¶ˆæ¯å‘é€ä¸è½¬å‘æœºåˆ¶åŸç†</a></li><li><a href="https://github.com/ibireme/YYKit" target="_blank" rel="noopener">YYKit</a></li><li><a href="https://nshipster.cn/type-encodings/" target="_blank" rel="noopener">Type Encodings</a></li></ul>]]></content>
      
      
    </entry>
    
    <entry>
      <title>ä» Notification.Name çœ‹ Swift å¦‚ä½•ä¼˜é›…çš„è§£å†³ String ç¡¬ç¼–ç </title>
      <link href="/2018/08/05/RawRepresentable/"/>
      <url>/2018/08/05/RawRepresentable/</url>
      <content type="html"><![CDATA[<h2 id="å‰é¢"><a href="#å‰é¢" class="headerlink" title="å‰é¢"></a>å‰é¢</h2><p>åˆå­¦ Swift ä¸­ç›¸å…³ NSNotification çš„ä»£ç æ—¶, å‘ç°äº†ä¹‹å‰ç†Ÿæ‚‰çš„ name å‚æ•°çš„ç±»å‹ç”± Objective-C ä¸­çš„ NSString å˜æˆäº† Notification.Name ç±»å‹. å¹¶ä¸æ˜¯æˆ‘æœŸæœ›çš„ String ç±»å‹â€¦è¿™æ˜¯æ€ä¹ˆå›äº‹å‘¢?</p><h2 id="Swift-ä¸­å¦‚ä½•ä½¿ç”¨-Notification"><a href="#Swift-ä¸­å¦‚ä½•ä½¿ç”¨-Notification" class="headerlink" title="Swift ä¸­å¦‚ä½•ä½¿ç”¨ Notification"></a>Swift ä¸­å¦‚ä½•ä½¿ç”¨ Notification</h2><p>é‚£ä¹ˆ, åœ¨ Swift ä¸­å¦‚ä½•ä½¿ç”¨ Notification å‘¢, ä»¥ post ä¸ºä¾‹. </p><pre><code class="swift">NotificationCenter.default.post(name: Notification.Name.UIApplicationDidFinishLaunching, object: nil)</code></pre><p>å…¶ä¸­, <code>Notification.Name</code> æ˜¯å¯ä»¥çœç•¥çš„, å°±å˜ä¸ºäº†</p><pre><code class="swift">NotificationCenter.default.post(name: .UIApplicationDidFinishLaunching, object: nil)</code></pre><p>æŸ¥çœ‹å®šä¹‰å‘ç°äº† <code>UIApplicationDidFinishLaunching</code> å®é™…ä¸Šæ˜¯å®šä¹‰åœ¨ç»“æ„ä½“ <code>NSNotification.Name</code> æ‰©å±•(extension)ä¸­çš„çš„ä¸€ä¸ªé™æ€å¸¸é‡ (<code>static let</code>), ç±»å‹æ˜¯ <code>NSNotification.Name</code> </p><pre><code class="Swift">extension NSNotification.Name {    @available(iOS 4.0, *)    public static let UIApplicationDidEnterBackground: NSNotification.Name    @available(iOS 4.0, *)    public static let UIApplicationWillEnterForeground: NSNotification.Name    public static let UIApplicationDidFinishLaunching: NSNotification.Name    ...}</code></pre><p>æ‰€ä»¥æˆ‘ä»¬æ‰å¯ä»¥çœç•¥å‰é¢çš„ <code>Notification.Name</code> ç›´æ¥ä½¿ç”¨ <code>.UIApplicationDidFinishLaunching</code> (Notification.Name æ˜¯ NSNotification.Name çš„åˆ«å)</p><p>é‚£æˆ‘ä»¬å¦‚æœæƒ³è‡ªå®šä¹‰ä¸€ä¸ªé€šçŸ¥æ€ä¹ˆåŠå‘¢, ç›´æ¥å¯ä»¥ä»¿ç…§ç³»ç»Ÿçš„æ–¹å¼, æˆ‘ä»¬è‡ªå·±ä¸ºå…¶å¢åŠ ä¸€ä¸ª <code>extension</code></p><pre><code class="swift">extension Notification.Name {    static let LoginStatusChanged = Notification.Name(&quot;LoginStatusChanged&quot;)}</code></pre><p>å…¶ä¸­ <code>Notification.Name(&quot;LoginStatusChanged&quot;)</code> æ˜¯å…¶åˆå§‹åŒ–æ–¹æ³•, å¯æŸ¥çœ‹æ–‡æ¡£è¯´æ˜, ä½¿ç”¨æ—¶, å¯ç›´æ¥</p><pre><code class="swift">NotificationCenter.default.post(name: .LoginStatusChanged, object: nil)</code></pre><p>å› ä¸ºè¿™ä¸ªé€šçŸ¥ <code>LoginStatusChanged</code> æ˜¯å®šä¹‰åœ¨ <code>Notification.Name</code> ä¸­çš„äº†, æ‰€ä»¥ä¹Ÿæ²¡å¿…è¦åœ¨åç§°åé¢å¢åŠ  Notification ç­‰å­—æ ·æ¥è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªé€šçŸ¥äº†. æ‰€ä»¥ Swift ä¸­å¾ˆå¤šå®šä¹‰çš„åç§°éƒ½æ˜¯éå¸¸ç®€æ´çš„.</p><h2 id="å¯¹æ¯”-Objective-C-ä¸­çš„ä½¿ç”¨"><a href="#å¯¹æ¯”-Objective-C-ä¸­çš„ä½¿ç”¨" class="headerlink" title="å¯¹æ¯” Objective-C ä¸­çš„ä½¿ç”¨"></a>å¯¹æ¯” Objective-C ä¸­çš„ä½¿ç”¨</h2><p>å¯¹æ¯”ä¹‹å‰åœ¨ Objective-C ä¸­çš„ä½¿ç”¨</p><p><code>[[NSNotificationCenter defaultCenter] postNotificationName:&quot;xxxxxxxxxx&quot; object:nil</code></p><p>è¿™æ ·æ˜¯éå¸¸å®¹æ˜“å‡ºé”™çš„, æŸ¥è¿™æ ·çš„é”™è¯¯ç»å¸¸ä¹Ÿæ˜¯éå¸¸è´¹æ—¶è´¹åŠ›çš„, ä¹Ÿè®©äººçœ‹æ¥æ˜¯éå¸¸ä¸ä¼˜é›…çš„, æ‰€ä»¥æˆ‘ä»¬ç»å¸¸ä¼šè¿›è¡Œå®å®šä¹‰æˆ–è€…æ˜¯å¸¸é‡æ¥é˜²æ­¢å­—ç¬¦ä¸²ç¡¬ç¼–ç çš„é—®é¢˜. </p><p>ä½†è¿™å®é™…ä¸Šä¹Ÿæ˜¯ä¼šå¸¦æ¥ä¸€äº›ä»¤äººå¤´ç–¼çš„é—®é¢˜çš„:</p><ol><li>ä¸ºäº†è¡¨æ˜å®šä¹‰çš„å­—ç¬¦ä¸²å¸¸é‡æ˜¯ä¸€ä¸ªé€šçŸ¥å, è¿˜è¦ä¸ºå…¶å¢åŠ å†—é•¿çš„å‰ç¼€æˆ–è€…æ˜¯åç¼€</li><li>åœ¨å¼€å‘ä¸­è¿˜ç»å¸¸ä¼šåœ¨ä»£ç è¡¥å…¨ä¸­, çœ‹åˆ°æ ¹æœ¬ä¸å’Œåœºåˆçš„ä¸€äº›å¸¸é‡å</li><li>é€šå¸¸ä¸ºäº†ä½¿ç”¨æ–¹ä¾¿å’Œæ˜“äºç»´æŠ¤, è¿˜ä¼šåœ¨å°†æ‰€æœ‰çš„é€šçŸ¥å®šä¹‰åœ¨ä¸€ä¸ª xxDefine.h çš„å¤´æ–‡ä»¶ä¸­, å¹¶åœ¨ pch æ–‡ä»¶ä¸­å¼•ç”¨, æ­¤æ—¶å¦‚æœå¢åˆ æˆ–è€…ä¿®æ”¹äº†ä»»æ„é€šçŸ¥. å°†ä¼šå¼•èµ·å·¥ç¨‹çš„å…¨é‡é‡æ–°ç¼–è¯‘. ä¹Ÿå¾ˆæ˜¯å¤´ç–¼.<br>â€¦</li></ol><p>æ‰€ä»¥, Swift è¿™ç§ä½¿ç”¨æ–¹å¼å¯è°“æ˜¯ååˆ†ä¼˜é›….</p><h2 id="ä¸¾ä¸€åä¸‰"><a href="#ä¸¾ä¸€åä¸‰" class="headerlink" title="ä¸¾ä¸€åä¸‰"></a>ä¸¾ä¸€åä¸‰</h2><p>åœ¨å¼€å‘ä¸­, å…¶å®ç±»ä¼¼äº Notification è¿™ç§éœ€è¦ä¼ é€’å­—ç¬¦ä¸²çš„åœºæ™¯è¿˜æœ‰å¾ˆå¤š, æˆ‘ä»¬éƒ½å¯ä»¥ä½¿ç”¨è¿™ç±»ä½¿ç”¨æ–¹æ³•è¿›è¡Œä¼˜åŒ–.</p><h3 id="åœºæ™¯"><a href="#åœºæ™¯" class="headerlink" title="åœºæ™¯"></a>åœºæ™¯</h3><p>å‡è®¾æœ‰è¿™æ ·ä¸€ä¸ªåœºæ™¯, å®šä¹‰ä¸€ä¸ªç±» <code>EventReporter</code> ç”¨æ¥å¤„ç†åŸ‹ç‚¹è¯·æ±‚.</p><pre><code class="swift">class EventReporter {    static let shared = EventReporter()    func reportEvent(_ eventId: String, withParams params: [String:Any]?) {        // åŸ‹ç‚¹ä¸ŠæŠ¥é€»è¾‘    }}</code></pre><p>ç›¸ä¿¡è¿™æ ·çš„åœºæ™¯æ˜¯å¾ˆå¤šäººéƒ½è§è¿‡çš„, å…¶ä¸­ eventId æ˜¯æˆ‘ä»¬åŸ‹ç‚¹çš„äº‹ä»¶çš„ID, é‚£ä¹ˆè¯¥å¦‚ä½•ä½¿ç”¨ç±»ä¼¼ <code>Notification.Name</code> çš„æ–¹å¼æ¥ä¼˜åŒ–è¿™ç±»åœºæ™¯å‘¢?</p><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>ä»æ–‡æ¡£ä¸­çœ‹å‡º <code>Notification.Name</code> å®é™…ä¸Šæ˜¯éµä»äº†ä¸€ä¸ªåè®® <code>RawRepresentable</code></p><blockquote><p>Overview</p><p>With a RawRepresentable type, you can switch back and forth between a custom type and an associated RawValue type without losing the value of the original RawRepresentable type. Using the raw value of a conforming type streamlines interoperation with Objective-C and legacy APIs and simplifies conformance to other protocols, such as Equatable, Comparable, and Hashable.</p><p>The RawRepresentable protocol is seen mainly in two categories of types: enumerations with raw value types and option sets.</p></blockquote><p>ç®€å•çš„è¯´å°±æ˜¯, ä½¿ç”¨ <code>RawRepresentable</code> ç±»å‹, å¯ä»¥åœ¨è‡ªå®šä¹‰ç±»å‹å’Œå…¶å…³è”çš„ <code>RawValue</code> ç±»å‹ä¹‹é—´æ¥å›åˆ‡æ¢, å¯ç®€åŒ–ä¸ Objective-C å’Œä¼ ç»Ÿ API çš„äº¤äº’ï¼Œ ä¸¤ç±»ï¼šå…·æœ‰åŸå§‹å€¼ç±»å‹å’Œé€‰é¡¹é›†çš„æšä¸¾(OptionSet, å…¶å® Swift ä¸­çš„é€‰é¡¹é›†æšä¸¾å°±æ˜¯é›†æˆè‡ª <code>RawRepresentable</code> è¿™ä¸ª Protocol å®ç°çš„), è¯´ç™½äº†. å°±æ˜¯ç”¨ä¸€ä¸ªç±»å‹å°è£…ä¸€ä¸‹æˆ‘ä»¬æƒ³è¦ä½¿ç”¨çš„ç±»å‹æ¯”å¦‚è¯´ String, æ¥æ–¹ä¾¿äº¤äº’.</p><h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><p>ä½¿ç”¨èµ·æ¥å¾ˆç®€å•, å®šä¹‰ä¸€ä¸ªç»“æ„ä½“æ¥ç®¡ç†æ‰€æœ‰çš„åŸ‹ç‚¹äº‹ä»¶</p><pre><code class="swift">struct EventID: RawRepresentable {}</code></pre><p>æ ¹æ®ç¼–è¯‘å™¨æç¤º, è¡¥å…¨åè®®ä»£ç </p><pre><code class="swift">struct EventID: RawRepresentable {    typealias RawValue = String    var rawValue: String    init?(rawValue: String) {    }}</code></pre><p>ä»è¿™å°±æ›´å®¹æ˜“çœ‹å‡ºå…¶åŸç†, å®é™…ä¸Šå†…éƒ¨çš„ <code>rawValue</code> å±æ€§å°±æ˜¯æˆ‘ä»¬éœ€è¦ä½¿ç”¨çš„ String ç±»å‹çš„äº‹ä»¶å, åˆå§‹åŒ–æ–¹æ³•ä¼ å…¥è¯¥ String å¯¹å…¶èµ‹å€¼å³å¯, è¿”å› <code>EventID</code> ç±»å‹çš„ç»“æ„ä½“</p><p>è¿™é‡Œå‘ç°åˆå§‹åŒ–æ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ª <code>Optional</code> ç±»å‹, è¿™æ ·ä½¿ç”¨èµ·æ¥è¿˜éœ€è¦è§£åŒ…, ä¸å¤ªæ–¹ä¾¿, å¯ä»¥çœ‹åˆ° <code>Notification.Name</code> çš„åˆå§‹åŒ–æ–¹æ³•è¿”å›å¹¶ä¸æ˜¯ <code>Optional</code>, å› ä¸ºå®šä¹‰éƒ½æ˜¯éå¸¸ç¡®å®šçš„äº‹ä»¶å(é€šçŸ¥å), è€Œä¸” <code>init</code> æ–¹æ³•ä¸­ä¹Ÿä¸ä¼šäº§ç”Ÿå¼‚å¸¸, æ‰€ä»¥æ­¤å¤„æ²¡ä»€ä¹ˆå¿…è¦ä½¿ç”¨ <code>Optional</code>, å»æ‰ <code>?</code> å³å¯</p><pre><code class="swift">struct EventID: RawRepresentable {    typealias RawValue = String    var rawValue: String    init(rawValue: String) {        self.rawValue = rawValue    }}</code></pre><p>é‚£ä¹ˆ, æˆ‘ä»¬çš„ä¸ŠæŠ¥ç±»çš„ä»£ç å¯ä»¥ä¿®æ”¹å¦‚ä¸‹, è¿™é‡Œè¿˜å¯ä»¥ç»™ <code>params</code> ä¸€ä¸ªé»˜è®¤å€¼, è¿™æ ·å¦‚æœæ²¡æœ‰å‚æ•°æ—¶, å¯ä»¥åªä¼ é€’ <code>eventId</code> ä¸€ä¸ªå‚æ•°å³å¯.</p><pre><code class="swift">class EventReporter {    static let shared = EventReporter()    func reportEvent(_ eventId: EventID, withParams params: [String:Any]? = nil) {        let event = eventId.rawValue        // åŸ‹ç‚¹é€»è¾‘    }}</code></pre><p>æœ€å, å®šä¹‰ä¸€ä¸ªåŸ‹ç‚¹äº‹ä»¶çœ‹çœ‹å§~, æ¨èå†™åˆ° <code>extension</code> ä¸­æ˜“äºç»´æŠ¤.</p><pre><code class="swift">extension EventID {    static let LoginPageExposure = EventID(rawValue: &quot;login_page_exposure&quot;)}</code></pre><p>é‚£ä¹ˆä½¿ç”¨çš„æ—¶å€™, </p><pre><code class="swift">EventReporter.shared.reportEvent(.LoginPageExposure)</code></pre><p>å½“æˆ‘ä»¬æ‰“å‡º <code>.</code> çš„æ—¶å€™, ä»£ç è¡¥å…¨å°±å·²ç»å°† <code>LoginPageExposure</code> æç¤ºç»™æˆ‘ä»¬äº†.</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä½¿ç”¨è¿™ç§æ–¹å¼ä¼˜åŒ–ä»£ç , ä¸ä»…å¯ä»¥è®©ä»£ç æ„å›¾å®¹æ˜“ç†è§£, ä½¿ç”¨ä¹Ÿæ›´åŠ ç®€å•ä¸ä¼šå‡ºé”™. è€Œä¸”ä¹Ÿä¸ä¼šä½¿å¾— <code>LoginPageExposure</code> äº‹ä»¶ååœ¨ä¸æƒ³è¦å‡ºç°çš„æ—¶å€™è¢«ä»£ç è¡¥å…¨åŠŸèƒ½å¼ºè¡Œå¼¹å‡ºæ¥.</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://developer.apple.com/documentation/foundation/nsnotification/name" target="_blank" rel="noopener">NSNotification.Name</a></li><li><a href="https://developer.apple.com/documentation/swift/rawrepresentable" target="_blank" rel="noopener">RawRepresentable</a></li></ul>]]></content>
      
      
    </entry>
    
    <entry>
      <title>SVN è¿ç§»è‡³ Git å®Œæ•´è®°å½•</title>
      <link href="/2018/07/26/svn-to-git/"/>
      <url>/2018/07/26/svn-to-git/</url>
      <content type="html"><![CDATA[<h1 id="Git-ä¸‡å²"><a href="#Git-ä¸‡å²" class="headerlink" title="Git ä¸‡å²"></a>Git ä¸‡å²</h1><p>ä¸ºä»€ä¹ˆåœ¨ 8102 å¹´è¿˜åœ¨ç”¨ SVN å°±ä¸è¦é—®æˆ‘äº†..æ€»ä¹‹ Git ä¸‡å²â€¦</p><h2 id="Clone"><a href="#Clone" class="headerlink" title="Clone"></a>Clone</h2><h3 id="å®Œæ•´è¿ç§»"><a href="#å®Œæ•´è¿ç§»" class="headerlink" title="å®Œæ•´è¿ç§»"></a>å®Œæ•´è¿ç§»</h3><p>Git æä¾›äº†ä» SVN è¿ç§»çš„å·¥å…·å‘½ä»¤ <code>git svn clone</code>, å¯åœ¨ SVN ä¸­, æ˜¯ä»¥ç›®å½•å½¢å¼, trunk, branches, tags æ¥å­˜å‚¨çš„, å¦‚ä½•ä¿ç•™å‘¢?</p><p>å¦‚æœä½ çš„ SVN ä¸­éƒ½æ˜¯ä»¥æ ‡å‡†å½¢å¼å­˜å‚¨å³ trunk ä¸­ä¸ºä¸»å¹², branches ä¸­ä¸ºæ‰€æœ‰åˆ†æ”¯, åˆ™å¯ä»¥ç›´æ¥ä½¿ç”¨å‚æ•° <code>-s</code>, å¦åˆ™åˆ™éœ€è¦è‡ªå·±æŒ‡å®šå¯¹åº”çš„ç›®å½•.</p><p>æ¯”å¦‚, æˆ‘ä»¬çš„é¡¹ç›®ä¸­, åˆ†æ”¯æ˜¯ä»¥è¿™ç§ç›®å½•ç»“æ„å­˜å‚¨çš„</p><pre><code>branches  |  |- develop  |     |  |     |- dev1_åˆ†æ”¯  |     |- dev2_åˆ†æ”¯  |  |- personal  |     |  |     |- xxx1_åˆ†æ”¯  |     |- xxx2_åˆ†æ”¯</code></pre><p>åˆ™, æˆ‘éœ€è¦ä½¿ç”¨å¤šä¸ª â€“branches å‘½ä»¤æ¥æŒ‡å®šå¯¹åº”çš„ä¸¤ä¸ªåˆ†æ”¯ç›®å½•</p><pre><code>--branches=branches/develop --branches=branches/personal</code></pre><p>ç”¨æ¥æŒ‡å®šæˆ‘ä»¬çš„ä¸¤ä¸ªåˆ†æ”¯ç›®å½• <code>branches/develop</code> å’Œ <code>branches/personal</code>, è¿™é‡Œéœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ <strong>æŒ‡å®šçš„åˆ†æ”¯ç›®å½•åº”è¯¥æ˜¯åˆ†æ”¯æ‰€åœ¨æ–‡ä»¶å¤¹çš„ä¸Šä¸€çº§æ–‡ä»¶å¤¹, æ¯”å¦‚æ­¤å¤„ç›®å½•æ˜¯ branches/develop, è€Œä¸åº”è¯¥æ˜¯ branches/develop/dev1_åˆ†æ”¯</strong></p><p>åœ¨æˆ‘ä»¬é¡¹ç›®ä¸­, trunk å’Œ tags éƒ½æ˜¯æŒ‰ç…§æ ‡å‡†å½¢å¼å­˜å‚¨çš„, æ‰€ä»¥åªè¦å†åŠ ä¸€ä¸ªå‘½ä»¤ <code>-s</code> å³å¯, ç›¸å½“äºè¡¥å……äº† <code>--trunk=trunk --tags=tags --branches=branches</code> åªä¸è¿‡æˆ‘ä»¬è¿™é‡Œ branches é‡Œé¢æ²¡æœ‰åˆ†æ”¯äº†. è¿™ä¸ªæ²¡å…³ç³»~</p><p>æ‰€ä»¥ clone çš„å®Œæ•´å‘½ä»¤å¦‚ä¸‹</p><pre><code>git svn clone http://xxxx/xxxx/xxxx/xxxx \    --branches=branches/develop \    --branches=branches/personal \    -s</code></pre><h3 id="ç”¨æˆ·ä¿¡æ¯"><a href="#ç”¨æˆ·ä¿¡æ¯" class="headerlink" title="ç”¨æˆ·ä¿¡æ¯"></a>ç”¨æˆ·ä¿¡æ¯</h3><p>è¿™æ ·å…¶å®å·²ç»æ˜¯æ²¡é—®é¢˜çš„äº†, ä½†æ˜¯æˆ‘ä»¬è¿˜å¸Œæœ›åœ¨ SVN ä¸Šæäº¤çš„ç”¨æˆ·ä¿¡æ¯ä¹Ÿèƒ½é¡ºåˆ©çš„è¿ç§»åˆ° Git ä¸­æ¥, å› ä¸º SVN ä¸­æäº¤ä¿¡æ¯åªæœ‰ç”¨æˆ·å, è€Œ Git åˆ™éœ€è¦ç”¨æˆ·åå’Œé‚®ç®±ä¸¤ä¸ªä¿¡æ¯, æ‰€ä»¥éœ€è¦åˆ¶å®šåç§°å¯¹åº”åç§°å’Œé‚®ç®±çš„æ˜ å°„å…³ç³».</p><p>è¿™é‡Œæˆ‘ä½¿ç”¨æ–‡ä»¶çš„æ–¹å¼, åœ¨æœ¬åœ°åˆ›å»ºå¥½æ–‡ä»¶å¤¹, å‡†å¤‡ä¸€ä¼šè¿›è¡Œ clone, åœ¨æ­¤æ–‡ä»¶å¤¹ä¸­, æˆ‘åˆ›å»ºäº† name.txt æ¥è¿›è¡Œåç§°çš„æ˜ å°„, å†…å®¹æ ¼å¼å¦‚ä¸‹:</p><pre><code>yuanxuhan = yuanxuhan &lt;yuanxuhan@xxx.com&gt;xxx = xxx &lt;xxx@xxx.com&gt;</code></pre><p>éœ€è¦æ³¨æ„çš„æ˜¯, <strong>å¦‚æœæƒ³è¦è¿›è¡Œç”¨æˆ·ä¿¡æ¯çš„è¿ç§», åˆ™éœ€è¦æŠŠåœ¨ SVN ä¸­æäº¤è¿‡çš„æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯éƒ½è¦è¿›è¡Œå¯¹åº”, å¦åˆ™ä¼šæŠ¥é”™</strong></p><p>ç„¶ååœ¨ clone çš„å‘½ä»¤ä¸­, å¢åŠ  <code>--authors-file=name.txt</code> æ¥æŒ‡å®šæ˜ å°„ä¿¡æ¯æ–‡ä»¶</p><blockquote><p>ä¸ºäº†è·å¾— SVN ä½¿ç”¨çš„ä½œè€…åå­—åˆ—è¡¨ï¼Œå¯ä»¥è¿è¡Œè¿™ä¸ªï¼š</p><p>svn log â€“xml | grep author | sort -u | \<br>  perl -pe â€˜s/.<em>&gt;(.</em>?)&lt;.*/$1 = /â€˜</p></blockquote><h3 id="å®Œæ•´å‘½ä»¤"><a href="#å®Œæ•´å‘½ä»¤" class="headerlink" title="å®Œæ•´å‘½ä»¤"></a>å®Œæ•´å‘½ä»¤</h3><pre><code>git svn clone http://xxxx/xxxx/xxxx/xxxx \    --authors-file=users.txt \    --branches=branches/develop \    --branches=branches/personal \    -s</code></pre><p>ç­‰å¾… clone å®Œæ¯•</p><h2 id="æ•´ç†"><a href="#æ•´ç†" class="headerlink" title="æ•´ç†"></a>æ•´ç†</h2><h3 id="ä¿ç•™åˆ†æ”¯"><a href="#ä¿ç•™åˆ†æ”¯" class="headerlink" title="ä¿ç•™åˆ†æ”¯"></a>ä¿ç•™åˆ†æ”¯</h3><p>clone å®Œæ¯•ä¹‹å, ä½¿ç”¨ <code>git branch</code>, å‘ç°åªæœ‰ä¸€ä¸ª master åˆ†æ”¯, å…¶å®æ˜¯ Git å°† SVN çš„ trunk è½¬æ¢æˆäº† master, <strong>è€Œå…¶ä»–çš„ branches åˆ™å˜æˆäº† git çš„ remote åˆ†æ”¯ origin/xxx, ä»¥è¿œç«¯åˆ†æ”¯çš„å½¢å¼å­˜åœ¨äº†æœ¬åœ°</strong>, å¯ä»¥ä½¿ç”¨å‘½ä»¤ <code>git branch -r</code> æ£€æŸ¥åˆ†æ”¯è½¬æ¢çš„æ²¡æ¯›ç—…~</p><p>è¿™é‡Œæˆ‘ä»¬è¦ä¿ç•™æ‰€æœ‰åˆ†æ”¯ä¿¡æ¯. æ‰€ä»¥è¦å¯¹æ‰€æœ‰åˆ†æ”¯è¿›è¡Œ <code>checkout -b</code>, æŒ‰ç…§è‡ªå·± Git çš„ä¸€äº›è§„èŒƒä¿ç•™åˆ†æ”¯å³å¯. å¦‚</p><p><code>git checkout -b feature/3.0.1 origin/dev1_åˆ†æ”¯</code></p><p>å¦‚æœä¸éœ€è¦æ•´ç†åˆ†æ”¯åç­‰éœ€æ±‚, ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹é¢æä¾›çš„ç›´æ¥ç§»åŠ¨æ–‡ä»¶å¤¹çš„æ“ä½œ</p><h3 id="ä¿ç•™-tag"><a href="#ä¿ç•™-tag" class="headerlink" title="ä¿ç•™ tag"></a>ä¿ç•™ tag</h3><p>æˆ‘ä»¬è¿™ä¸ªé¡¹ç›®æ¯”è¾ƒå°, è¿˜æ²¡æœ‰ tag, å¦‚æœæœ‰çš„è¯å¯ä»¥å‚ç…§æ–‡æ¡£æä¾›çš„æ–¹æ³•(æœªè¯•è¿‡)</p><blockquote><p>ä¸ºäº†å°†æ ‡ç­¾å˜ä¸ºåˆé€‚çš„ Git æ ‡ç­¾ï¼Œè¿è¡Œ</p></blockquote><pre><code>$ cp -Rf .git/refs/remotes/origin/tags/* .git/refs/tags/$ rm -Rf .git/refs/remotes/origin/tags</code></pre><blockquote><p>è¿™ä¼šä½¿åŸæ¥åœ¨ remotes/origin/tags/ é‡Œçš„è¿œç¨‹åˆ†æ”¯å¼•ç”¨å˜æˆçœŸæ­£çš„ï¼ˆè½»é‡ï¼‰æ ‡ç­¾ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œå°† refs/remotes ä¸‹å‰©ä½™çš„å¼•ç”¨ç§»åŠ¨ä¸ºæœ¬åœ°åˆ†æ”¯ï¼š</p></blockquote><pre><code>$ cp -Rf .git/refs/remotes/* .git/refs/heads/$ rm -Rf .git/refs/remotes</code></pre><h3 id="åˆ é™¤è¿œç«¯ä¿¡æ¯"><a href="#åˆ é™¤è¿œç«¯ä¿¡æ¯" class="headerlink" title="åˆ é™¤è¿œç«¯ä¿¡æ¯"></a>åˆ é™¤è¿œç«¯ä¿¡æ¯</h3><p>å°†æ‰€æœ‰åˆ†æ”¯éƒ½æ•´ç†å®Œæ¯•å, ä½¿ç”¨ <code>git branch</code> æ£€æŸ¥ç¡®è®¤æ— è¯¯ä¹‹å, åˆ é™¤ origin çš„ä¿¡æ¯å³å¯,</p><pre><code>git remote rm origin</code></pre><p>æˆ–è€…</p><pre><code>rm -Rf .git/refs/remotes</code></pre><h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><h3 id="é’©å­"><a href="#é’©å­" class="headerlink" title="é’©å­"></a>é’©å­</h3><p>æ•´ç†ä¹‹åå¯ä»¥è¿›è¡Œé…ç½® Git hook ç­‰ç­‰å…¶ä»–ä¿¡æ¯, è¿™ä¸ªä½¿ç”¨çš„æ˜¯æˆ‘ä»¬å°ç»„çš„è§„èŒƒè„šæœ¬, ä¸æ–¹ä¾¿è®°å½•.</p><h3 id="gitignore"><a href="#gitignore" class="headerlink" title=".gitignore"></a>.gitignore</h3><blockquote><p><a href="https://www.gitignore.io" target="_blank" rel="noopener">https://www.gitignore.io</a></p></blockquote><p>å¯ä»¥åœ¨è¿™ä¸ª<a href="https://www.gitignore.io" target="_blank" rel="noopener">ç½‘å€</a> è¾“å…¥ä¸‰ä¸ªå…³é”®å­—, <code>Swift</code>, <code>Xcode</code>, <code>macOS</code> ä¼šè‡ªåŠ¨ç»„åˆå¥½ .gitignore æ–‡ä»¶, å­˜æ”¾åˆ° Git ä»“åº“ç›®å½•ä¸­å¹¶æäº¤.</p><h3 id="æ–°å¢-tag"><a href="#æ–°å¢-tag" class="headerlink" title="æ–°å¢ tag"></a>æ–°å¢ tag</h3><p>ä¹‹å‰ SVN ç®¡ç†çš„æ¯”è¾ƒæ¾æ•£, è½¬æ¢ä¹‹å, åº”è¯¥åœ¨ App Connet ä¸­, æ‰¾åˆ°ä¸Šæ¶åŒ…çš„ç‰ˆæœ¬å·å’Œ build å·, åœ¨æŒç»­é›†æˆå¹³å°ä¸­æŸ¥æ‰¾è¯¥ç‰ˆæœ¬çš„å¯¹åº” build, æŸ¥çœ‹æœ€åä¸€ä¸ª commit, å¹¶åœ¨è¯¥ commit å¤„å¢åŠ  tag, å¹¶ä¸”åˆ†æ”¯å¯ä»¥åˆ æ‰äº†, ä»¥ä¾¿çº¿ä¸Š bug çš„å®šä½å’Œè§£å†³.</p><h2 id="å…³è”è¿œç«¯"><a href="#å…³è”è¿œç«¯" class="headerlink" title="å…³è”è¿œç«¯"></a>å…³è”è¿œç«¯</h2><p>åœ¨ Git æœåŠ¡å™¨åˆ›å»ºå¥½æ–°çš„ä»“åº“å, å…³è”ä¸€ä¸‹è¿œç«¯æœåŠ¡å™¨</p><pre><code>git remote add origin http://xxx/xxx.git</code></pre><p>æ¨é€æ‰€æœ‰åˆ†æ”¯</p><pre><code>git push origin --all</code></pre><p>æ¨é€æ‰€æœ‰æ ‡ç­¾</p><pre><code>git push origin --tags</code></pre><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://git-scm.com/book/zh/v2/Git-%E4%B8%8E%E5%85%B6%E4%BB%96%E7%B3%BB%E7%BB%9F-%E8%BF%81%E7%A7%BB%E5%88%B0-Git" target="_blank" rel="noopener">9.2 Git ä¸å…¶ä»–ç³»ç»Ÿ - è¿ç§»åˆ° Git</a></p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>åŸºäº iOS 11 Vision çš„äººè„¸è¯†åˆ«å’Œç‰¹å¾ç‚¹æå–çš„è¡¨æƒ…åŒ…æ¨¡ä»¿åŠŸèƒ½çš„å®è·µ</title>
      <link href="/2018/07/15/vision-demo/"/>
      <url>/2018/07/15/vision-demo/</url>
      <content type="html"><![CDATA[<h1 id="å‰é¢"><a href="#å‰é¢" class="headerlink" title="å‰é¢"></a>å‰é¢</h1><p>æƒ³èµ·æ¥å»å¹´åœ¨ä¸Šå®¶å…¬å¸åšçš„ä¸ªå° Demo, è®°å½•ä¸€ä¸‹å§, èƒŒæ™¯æ˜¯å½“æ—¶é£Ÿå ‚ç©ºé—´æ‰¿å—ä¸ä½äº†, å¤§ä½¬ä»¬ç»„ç»‡äº†ä¸€åœºé»‘å®¢é©¬æ‹‰æ¾, å®ç°æ‘‡å·åƒé¥­, å„ä¸ªéƒ¨é—¨çš„å¤§ä½¬å‰åç«¯å¼€å‘è®¾è®¡å¸ˆäº§å“éƒ½ç»„é˜Ÿå‚èµ›, æˆ‘å½“æ—¶æ‰€åœ¨çš„éƒ¨é—¨éƒ½åœ¨å¿™ç€äº§å“ä¸Šçº¿æ²¡äººæ„¿æ„å‚åŠ , ä»‹äºæˆ‘é€—æ¯”çš„æ½œè´¨, ç‹¬è‡ªä¸€äººé‚€è¯·äº†ä¸€ä¸ªäº§å“å°ä¼™ä¼´ç»„æˆäº†å”¯ä¸€ä¸€ä¸ªåªæœ‰ä¸¤ä¸ªäººå‚èµ›çš„é˜Ÿä¼â€¦å¤§æ¦‚æ˜¯èŠ±äº†2å¤©æ—¶é—´å®Œæˆâ€¦</p><p><strong>æ„Ÿè°¢æˆ‘çš„äº§å“å°ä¼™ä¼´ @åˆ˜æµ·æ»¨, ç‚¹å­éƒ½æ˜¯ä»–æƒ³çš„.</strong></p><p>åˆè¡·æ˜¯, æ¯æ—¥æ¨èä¸€ä¸ªè¡¨æƒ…åŒ…, ç„¶åå¤§å®¶è¿›è¡Œæ¨¡ä»¿è‡ªæ‹, åŒ¹é…ç›¸ä¼¼åº¦. è¿›è¡Œæ’é˜Ÿåƒé¥­. å¤§è‡´æ•ˆæœå›¾å¦‚ä¸‹â€¦æƒ¨ä¸å¿ç¹â€¦</p><p><img src="https://user-gold-cdn.xitu.io/2017/12/21/1607730eeb227377?w=375&amp;h=667&amp;f=gif&amp;s=2584477" alt="æ•ˆæœå›¾"></p><h1 id="åŠŸèƒ½ç‚¹"><a href="#åŠŸèƒ½ç‚¹" class="headerlink" title="åŠŸèƒ½ç‚¹"></a>åŠŸèƒ½ç‚¹</h1><ul><li>AVFoundation å®ç°è‡ªæ‹çš„ç›¸æœºåŠŸèƒ½</li><li>åŸºäº Vision è¿›è¡Œå®æ—¶äººè„¸è¿½è¸ª</li><li>æ‹ç…§ååŸºäº Vision è¿›è¡Œäººè„¸ç‰¹å¾ç‚¹æå–, å¹¶ä¸”å±•ç¤ºå‡ºæ¥</li><li>è¡¨æƒ…åŒ…çš„ç‰¹å¾ç‚¹å’Œè‡ªæ‹çš„ç‰¹å¾ç‚¹è¿›è¡Œç›¸ä¼¼åº¦åŒ¹é…</li><li>å¯¹è‡ªæ‹è¿›è¡Œå‰ªè£, è¡¨æƒ…åŒ…ä¸­çš„æ–‡å­—æ·»åŠ , äººè„¸ç£¨çš®ç¾é¢œ, å®Œæˆè¡¨æƒ…åŒ…åˆ¶ä½œ, åˆ†äº«.</li></ul><h1 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h1><h2 id="æ­å»ºé¡¹ç›®"><a href="#æ­å»ºé¡¹ç›®" class="headerlink" title="æ­å»ºé¡¹ç›®"></a>æ­å»ºé¡¹ç›®</h2><p>å› ä¸ºè¦ä½¿ç”¨ Vision æ¡†æ¶æ‰€ä»¥åªèƒ½æ”¯æŒ iOS 11 åŠä»¥ä¸Šç‰ˆæœ¬.</p><p>æœ¬æ¥æœ€å¼€å§‹æ˜¯å¸Œæœ›å¯ä»¥åšå®Œæ•´çš„, ä½†æ˜¯æ—¶é—´å¤ªå°‘äº†, åªåšäº†ä¸Šé¢æåˆ°çš„è¿™äº›åŠŸèƒ½, åŠŸèƒ½å°‘, æ‰€ä»¥ç»“æ„éå¸¸ç®€å•, åœ¨â€æˆ‘â€çš„å’Œâ€æˆ‘ä»¬çš„â€ä¸¤ä¸ªæ ‡ç­¾ä¸‹é¢å†…å®¹å‡ ä¹æ²¡æœ‰â€¦.</p><p><img src="https://user-gold-cdn.xitu.io/2017/12/25/1608d0964120a1b7?w=1024&amp;h=768&amp;f=jpeg&amp;s=349406" alt="é¡¹ç›®ç»“æ„å›¾"></p><p>é‚£åé¢å°±åªè¯´ä¸€ä¸‹æ ¸å¿ƒåŠŸèƒ½çš„ç»“æ„å§.</p><p><img src="https://user-gold-cdn.xitu.io/2017/12/25/1608d09b666ef188?w=1024&amp;h=768&amp;f=jpeg&amp;s=142428" alt="æ ¸å¿ƒåŠŸèƒ½ç»“æ„"></p><p>ä»ä¸‹è‡³ä¸Š, çŸ­æ—¶é—´å¿«é€Ÿå®ç°çš„ç®€å•çš„ç»“æ„, å¯èƒ½è€ƒè™‘ä¸å……åˆ†å¯¼è‡´ä¸æ˜¯ç‰¹åˆ«ç†æƒ³.</p><ul><li>äººè„¸æ¨¡å‹ : å°è£… Vison çš„äººè„¸æ¨¡å‹, æ–¹ä¾¿è‡ªå·±ä½¿ç”¨</li><li>äººè„¸å·¥å…·ç±» : æä¾›æ ¹æ®å›¾ç‰‡çš„äººè„¸æ£€æµ‹å’Œç‰¹å¾ç‚¹æå–ç­‰æ–¹æ³•</li><li>ç‰¹å¾æ¯”è¾ƒ : æä¾›ä¸¤ä¸ªç‰¹å¾çš„ç›¸ä¼¼åº¦æ¯”è¾ƒ</li><li>ç›¸æœºå·¥å…·ç±» : å®Œæ•´çš„å¤„ç†ç›¸æœºçš„é€»è¾‘ä¸€ç›´åˆ°æ‹å¥½ä¸€å¼ ç…§ç‰‡äº¤ç»™æ§åˆ¶å™¨</li><li>è§†å›¾æ§åˆ¶å™¨ : åˆå§‹åŒ–ç›¸æœºå·¥å…·ç±», æ§åˆ¶ç›¸æœºä¼šè¯çš„å¯åŠ¨å’Œåœæ­¢, ä»¥åŠå¾—åˆ°ç…§ç‰‡çš„å¾—åˆ†å’Œä¿å­˜.</li></ul><p>ä¸‹é¢æ˜¯å„ä¸ªæ ¸å¿ƒåŠŸèƒ½çš„ä¸€äº›å®ç°è¿‡ç¨‹.</p><h2 id="è‡ªå®šä¹‰ç›¸æœº"><a href="#è‡ªå®šä¹‰ç›¸æœº" class="headerlink" title="è‡ªå®šä¹‰ç›¸æœº"></a>è‡ªå®šä¹‰ç›¸æœº</h2><p>è‡ªå®šä¹‰ç›¸æœºè¿™éƒ¨åˆ†.èµ°äº†ä¸€ç‚¹å¼¯è·¯, å› ä¸ºåªæ”¯æŒ iOS 11, åŸæ¥ç†Ÿæ‚‰çš„åˆ°å¤„å¯ä»¥ Copy çš„ AVFoundation ä»£ç æœ‰ä¸€äº› API åˆ†åˆ«åœ¨ iOS 10 å’Œ iOS 11 ä¸­è¢«å¼ƒç”¨äº†â€¦æˆ‘æœ‰çœ‹ä¸æƒ¯å¼ƒç”¨ API çš„è­¦å‘Š, äºæ˜¯èµ°ä¸Šäº†å¡«å‘ä¹‹è·¯â€¦</p><p>é¦–å…ˆ <code>XYCaptureController.m</code> ä¸ºè‡ªæ‹çš„è§†å›¾æ§åˆ¶å™¨, æˆ‘å°†ç›¸æœºçš„ç›¸å…³å¤„ç†å°è£…æå–å‡ºæ¥ <code>XYCaptureHelper.m</code> å¥½å¤„æ˜¯</p><ul><li>æ§åˆ¶å™¨é€»è¾‘ç®€å•, ç®—ä¸Šç©ºè¡Œä¹Ÿæ‰100å¤šè¡Œä»£ç ;</li><li>å¦‚æœåˆ«çš„é¡¹ç›®è¿˜éœ€è¦ç›¸æœºå¯ä»¥ç›´æ¥æ‹½è¿‡å»ç¨å¾®ä¿®æ”¹ä¸€ä¸‹å°±èƒ½ç”¨äº†.</li></ul><p>åœ¨ <code>XYCaptureHelper.h</code> ä¸­æš´éœ²æœ€æ ¸å¿ƒçš„æ–¹æ³•æ˜¯åˆ›å»ºç›¸æœºä¼šè¯</p><pre><code class="objc">/**åœ¨Viewä¸Šåˆ›å»ºæ‰«æä¼šè¯*/- (void)setupCaptureSessionDisplayOnView:(UIView *)captureView;</code></pre><p>æ–¹æ³•å®ç°å…ˆæ ¡éªŒäº†ä¸€ä¸‹æƒé™, æ„Ÿå…´è¶£çš„å¯ä»¥çœ‹ <code>XYAuthUtil</code> å¯¹æƒé™å’Œè·³è½¬è®¾ç½®ç•Œé¢çš„ç®€å•å°è£….</p><p>æ ¡éªŒæƒé™å, åˆ›å»ºç›¸æœºä¼šè¯åˆ†ä¸ºä¸‰æ­¥</p><pre><code class="objc">/**åˆ›å»ºç›¸æœºæ‰«æè§†å›¾*/- (void)setupCaptureOnView:(UIView *)captureView {    //  å¼±å¼•ç”¨çˆ¶è§†å›¾, æ–¹ä¾¿å¸ƒå±€ç­‰å…¶ä»–æ§åˆ¶    self.captureView = captureView;    //  åˆ›å»ºç›¸æœºä¼šè¯    [self setupCaptureSession];    //  åˆ›å»ºç›¸æœºé¢„è§ˆå±‚    [self setupCaptureDisplay];    //  åˆ›å»ºäººè„¸é¢„è§ˆå±‚    [self setupFacePreview   ];}</code></pre><h3 id="åˆ›å»ºç›¸æœºä¼šè¯"><a href="#åˆ›å»ºç›¸æœºä¼šè¯" class="headerlink" title="åˆ›å»ºç›¸æœºä¼šè¯"></a>åˆ›å»ºç›¸æœºä¼šè¯</h3><pre><code class="objc">- (void)setupCaptureSession {    _captureQueue = dispatch_queue_create(&quot;com.hanyx.PassionForEating.Capture&quot;, DISPATCH_QUEUE_SERIAL);    self.session = [[AVCaptureSession alloc] init];    self.session.sessionPreset = AVCaptureSessionPresetPhoto;    self.device = [self cameraWithPostion:AVCaptureDevicePositionFront];    self.input = [[AVCaptureDeviceInput alloc] initWithDevice:self.device error:nil];    AVCaptureVideoDataOutput *dataOutput = [[AVCaptureVideoDataOutput alloc] init];    [dataOutput setAlwaysDiscardsLateVideoFrames:YES];    [dataOutput setVideoSettings:@{(id)kCVPixelBufferPixelFormatTypeKey:@(kCVPixelFormatType_32BGRA)}];    [dataOutput setSampleBufferDelegate:self queue:_captureQueue];    self.dataOutput = dataOutput;    self.imageOutput = [[AVCapturePhotoOutput alloc] init];    if ([self.session canAddInput:self.input]) {        [self.session addInput:self.input];    }    if ([self.session canAddOutput:dataOutput]) {        [self.session addOutput:dataOutput];    }    if ([self.session canAddOutput:self.imageOutput]) {        [self.session addOutput:self.imageOutput];    }    AVCaptureConnection *connection = [dataOutput.connections firstObject];    [connection setVideoOrientation:AVCaptureVideoOrientationPortrait];</code></pre><p>å…¶å®å°±æ˜¯ä¸»æµçš„å†™æ³•, è·å–ç›¸æœºè®¾å¤‡, æ ¹æ®è®¾å¤‡åˆ›å»ºè¾“å…¥, è¾“å‡ºå¯¹è±¡, éƒ½æ·»åŠ åˆ°ç›¸æœºä¼šè¯ä¸­, æ¯”è¾ƒé‡è¦çš„æ˜¯, å®ç°äº† <code>AVCaptureVideoDataOutputSampleBufferDelegate</code> ä»£ç†, æ¥è·å¾—åˆ°ç›¸æœºæ•è·çš„ç¼“å†²å¸§ä¿¡æ¯.</p><p>å…³äº iOS 11 ç¬¬ä¸€å¤„ä¸åŒæ˜¯ <code>imageOutput</code> ä¹‹å‰æˆ‘ä»¬ä¹ æƒ¯å»ä½¿ç”¨ <code>AVCaptureStillImageOutput</code> å¯¹è±¡æ¥è·å–ç›¸æœºæ‹æ‘„çš„é«˜æ¸…ç…§ç‰‡, ä½†æ˜¯è¿™ä¸ªç±»åœ¨ iOS 10 ä¸­è¢«å¼ƒç”¨äº†, éœ€è¦ä½¿ç”¨ <code>AVCapturePhotoOutput</code> å¯¹è±¡ä»£æ›¿.</p><h3 id="åˆ›å»ºç›¸æœºé¢„è§ˆå±‚"><a href="#åˆ›å»ºç›¸æœºé¢„è§ˆå±‚" class="headerlink" title="åˆ›å»ºç›¸æœºé¢„è§ˆå±‚"></a>åˆ›å»ºç›¸æœºé¢„è§ˆå±‚</h3><pre><code class="objc">- (void)setupCaptureDisplay {    //  é¢„è§ˆå±‚çš„ç”Ÿæˆ    self.previewLayer = [[AVCaptureVideoPreviewLayer alloc] initWithSession:self.session];    self.previewLayer.videoGravity = AVLayerVideoGravityResizeAspectFill;    [self.captureView.layer insertSublayer:self.previewLayer atIndex:0];}</code></pre><p>åˆ›å»ºé¢„è§ˆå±‚ä¸»è¦è¦è®¾ç½®çš„å°±æ˜¯æ˜¾ç¤ºçš„ç¼©æ”¾æ¨¡å¼, å’Œ UIView çš„ contentMode å¾ˆç›¸ä¼¼æä¾›äº†ä¸‰ç§, éå¸¸ç®€å•, ä¸€çœ‹å°±æ˜ç™½äº†.æˆ‘è¿™é‡Œä½¿ç”¨ <code>AVLayerVideoGravityResizeAspectFill</code> ä¿æŒç¼©æ”¾æ¯”ä¾‹æ¥å¡«å……è§†å›¾, é˜²æ­¢å‡ºç°é»‘è¾¹çš„æƒ…å†µ. å› ä¸ºåœ¨çˆ¶è§†å›¾ä¸­, å¯èƒ½å­˜åœ¨å…¶ä»–è§†å›¾, æ¯”å¦‚æ‹ç…§æŒ‰é’®ç­‰ç­‰, æ‰€ä»¥é¢„è§ˆå›¾å±‚æˆ‘è¿™é‡Œæ’å…¥åˆ°æœ€åº•å±‚</p><h3 id="åˆ›å»ºäººè„¸é¢„è§ˆå±‚"><a href="#åˆ›å»ºäººè„¸é¢„è§ˆå±‚" class="headerlink" title="åˆ›å»ºäººè„¸é¢„è§ˆå±‚"></a>åˆ›å»ºäººè„¸é¢„è§ˆå±‚</h3><pre><code class="objc">- (void)setupFacePreview {    CAShapeLayer *faceShape = [[CAShapeLayer alloc] init];    faceShape.fillColor     = [UIColor clearColor].CGColor;    faceShape.strokeColor   = [UIColor colorNamed:COLOR_Main].CGColor;    faceShape.lineWidth     = 1;    [self.captureView.layer addSublayer:faceShape];    self.faceShapeLayer     = faceShape;}</code></pre><p>äººè„¸é¢„è§ˆå±‚æˆ‘è¿™é‡Œä½¿ç”¨ <code>CAShapeLayer</code> æŒ‡å®šäº†ä¸€ä¸ªæ©™è‰²çš„é¢œè‰². ç”¨æ¥æ¡†æŸ±äººè„¸åŒºåŸŸ.</p><h3 id="ä¼šè¯æ§åˆ¶"><a href="#ä¼šè¯æ§åˆ¶" class="headerlink" title="ä¼šè¯æ§åˆ¶"></a>ä¼šè¯æ§åˆ¶</h3><p>å¯ä»¥å‘ç°. é¢„è§ˆå±‚æˆ‘éƒ½æ²¡æœ‰æŒ‡å®š <code>frame</code> å¯èƒ½ç”±äºå„ç§é—®é¢˜, è·å–çˆ¶è§†å›¾çš„ <code>frame</code><br>å¯èƒ½å¹¶ä¸å¦‚é¢„æœŸ, æ‰€ä»¥, æˆ‘åœ¨å¼€å§‹å›è¯çš„åœ°æ–¹, è¿›è¡Œäº† <code>frame</code> çš„è·å–å’Œå¯¹é¢„è§ˆå±‚ <code>frame</code> çš„è®¾ç½®</p><pre><code class="objc">- (void)startRunning {    [self.session startRunning];    dispatch_async(dispatch_get_main_queue(), ^{        //  è®¡ç®—å„ä¸ªè§†å›¾çš„å°ºå¯¸        self.captureFrame = self.captureView.frame;    });}- (void)stopRunning {    [self.session stopRunning];}- (void)setCaptureFrame:(CGRect)captureFrame {    if (CGRectEqualToRect(_captureFrame, captureFrame)) {        return ;    }    _captureFrame = captureFrame;    CGRect bounds = (CGRect){0, 0, captureFrame.size.width, captureFrame.size.height};    self.previewLayer.frame = bounds;    self.faceShapeLayer.frame = bounds;}</code></pre><p>è¿™ä¸ªåœ°æ–¹æˆ‘åˆ›å»ºäº† <code>self.captureFrame</code> çš„å±æ€§, è€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨ <code>self.captureView.frame</code> æ˜¯å› ä¸ºåœ¨æ•è·çš„è¿‡ç¨‹ä¸­, å¾ˆå¤šæ“ä½œå¯èƒ½éƒ½éœ€è¦è¯¥ <code>frame</code> ä¸­çš„ä¿¡æ¯, ä½†æ˜¯ <code>UIView</code> çš„ <code>frame</code> å®é™…ä¸Šåªå…è®¸åœ¨ä¸»çº¿ç¨‹è°ƒç”¨. æ‰€ä»¥è¿™é‡Œä½¿ç”¨å±æ€§æ–¹ä¾¿äº†æ“ä½œ.</p><h3 id="å®æ—¶ç¼“å†²å¸§çš„è·å–"><a href="#å®æ—¶ç¼“å†²å¸§çš„è·å–" class="headerlink" title="å®æ—¶ç¼“å†²å¸§çš„è·å–"></a>å®æ—¶ç¼“å†²å¸§çš„è·å–</h3><p>ä¹‹å‰å·²ç»è¯´è¿‡, å®ç°äº† <code>AVCaptureVideoDataOutputSampleBufferDelegate</code> ä»£ç†, æ¥è·å¾—åˆ°ç›¸æœºæ•è·çš„ç¼“å†²å¸§ä¿¡æ¯.å®ç°æ–¹æ³•</p><pre><code class="objc">- (void)captureOutput:(AVCaptureOutput *)captureOutput didOutputSampleBuffer:(CMSampleBufferRef)sampleBuffer fromConnection:(AVCaptureConnection *)connection {}</code></pre><p>å¯ä»¥æ ¹æ® <code>CMSampleBufferRef</code> æ¥è·å–åˆ°ç¼“å†²å¸§çš„å›¾ç‰‡, å›¾ç‰‡æ˜¯ä½è´¨é‡çš„.</p><h3 id="æ‹ç…§"><a href="#æ‹ç…§" class="headerlink" title="æ‹ç…§"></a>æ‹ç…§</h3><p>å› ä¸ºç…§ç‰‡è¾“å‡ºå¯¹è±¡æ¢æˆäº†æ–°çš„ <code>AVCapturePhotoOutput</code> æ‰€ä»¥æ‹ç…§éƒ¨åˆ†ä¹Ÿæœ‰æ‰€å˜åŒ–,</p><pre><code class="objc">- (void)captureWithSender:(UIButton *)sender {    //  éœ‡åŠ¨åé¦ˆ    [self.taptic impactOccurred];    AVCaptureConnection *con = [self.imageOutput connectionWithMediaType:AVMediaTypeVideo];    UIDeviceOrientation curDeviceOrientation = [[UIDevice currentDevice] orientation];    AVCaptureVideoOrientation avcaptureOrientation = [self avOrientationForDeviceOrientation:curDeviceOrientation];    [con setVideoOrientation:avcaptureOrientation];    [self.imageOutput capturePhotoWithSettings:[AVCapturePhotoSettings photoSettings] delegate:self];}</code></pre><p>è·å–è¿æ¥, æå‰è®¾ç½®äº†æ–¹å‘, é˜²æ­¢ç…§å‡ºæ¥çš„å›¾ç‰‡å¯èƒ½ä¼šæ—‹è½¬90Â°çš„é—®é¢˜. æ‹ç…§çš„è¿‡ç¨‹ä¹Ÿæœ‰å˜æ¢, åŸæ¥ä½¿ç”¨ <code>AVCaptureStillImageOutput</code> çš„æ—¶å€™å¾ˆæ–¹ä¾¿é€šè¿‡ <code>block</code> çš„æ–¹å¼è·å–åŸå›¾, ç°åœ¨éœ€è¦ä½¿ç”¨ä»£ç†. å®ç° <code>AVCapturePhotoCaptureDelegate</code> ä»£ç†, å½“æ‹ç…§æˆåŠŸæ—¶, ä¼šè°ƒç”¨å¦‚ä¸‹æ–¹æ³•æ¥è·å–é«˜æ¸…å›¾ç‰‡</p><pre><code class="objc">- (void)captureOutput:(AVCapturePhotoOutput *)output didFinishProcessingPhoto:(nonnull AVCapturePhoto *)photo error:(nullable NSError *)error {    NSData *imgData = photo.fileDataRepresentation;    UIImage *img = [UIImage imageWithData:imgData];}</code></pre><p>éœ€è¦å¤šè¯´ä¸€å¥çš„æ˜¯, <code>AVCapturePhotoSettings</code> æˆ‘æ·»åŠ äº†ä¸€ä¸ªå±æ€§, é€šè¿‡æ‡’åŠ è½½çš„æ–¹å¼åˆå§‹åŒ–æ¥è¿›è¡Œä½¿ç”¨, å¯æ˜¯åœ¨ç¬¬äºŒæ¬¡æ‹æ‘„çš„æ—¶å€™å°±ä¼šå¯¼è‡´å´©æºƒ, å› ä¸º <code>AVCapturePhotoSettings</code> å¯¹è±¡ä¸èƒ½é‡å¤ä½¿ç”¨, æ‰€ä»¥æˆ‘è¿™é‡Œæ¯æ¬¡æ‹ç…§çš„æ—¶å€™åˆ›å»ºäº†ä¸€ä¸ªå¯¹è±¡.</p><p>å…³äºè‡ªå®šä¹‰ç›¸æœºå¤§æ¦‚å†…å®¹å°±æ˜¯è¿™ä¹ˆå¤š, æ¥ä¸‹æ¥çœ‹å¦‚ä½•ä½¿ç”¨ Vision æ¥å¯¹æ•è·åˆ°çš„ç¼“å†²å¸§è¿›è¡Œäººè„¸è¿½è¸ª.</p><h2 id="äººè„¸è¿½è¸ª"><a href="#äººè„¸è¿½è¸ª" class="headerlink" title="äººè„¸è¿½è¸ª"></a>äººè„¸è¿½è¸ª</h2><h3 id="å¦‚ä½•æ ¹æ®ä¸€å¼ ç…§ç‰‡è·å–äººè„¸ä½ç½®"><a href="#å¦‚ä½•æ ¹æ®ä¸€å¼ ç…§ç‰‡è·å–äººè„¸ä½ç½®" class="headerlink" title="å¦‚ä½•æ ¹æ®ä¸€å¼ ç…§ç‰‡è·å–äººè„¸ä½ç½®?"></a>å¦‚ä½•æ ¹æ®ä¸€å¼ ç…§ç‰‡è·å–äººè„¸ä½ç½®?</h3><p>æˆ‘åœ¨ <code>XYFaceHelper</code> ä¸­å°è£…äº†å¦‚ä¸‹æ–¹æ³•, æ ¹æ®å›¾ç‰‡ <code>CIImage</code> è·å–ä¸€ä¸ªäººè„¸çŸ©å½¢åŒºåŸŸ <code>CGRect</code></p><pre><code class="objc">/** äººè„¸çŸ©å½¢åŒºåŸŸæ£€æµ‹ */+ (void)detectFaceRectWithImage:(CIImage *)image completion:(void(^)(CGRect faceRect))completion;</code></pre><p>å†…éƒ¨å®ç°å…¶å®å°±æ˜¯è°ƒç”¨äº† Vision æ¡†æ¶, ç®€å•çœ‹ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨ Vision æ¡†æ¶.</p><pre><code class="objc">/** äººè„¸çŸ©å½¢åŒºåŸŸæ£€æµ‹ */+ (void)detectFaceRectWithImage:(CIImage *)image completion:(void (^)(CGRect faceRect))completion {    if (!image || !completion) { return ; }    CGFloat imgW = image.extent.size.width;    CGFloat imgH = image.extent.size.height;    VNImageRequestHandler *vnHandler = [[VNImageRequestHandler alloc] initWithCIImage:image orientation:kCGImagePropertyOrientationUp options:@{}];    VNDetectFaceRectanglesRequest *request = [[VNDetectFaceRectanglesRequest alloc] initWithCompletionHandler:^(VNRequest * _Nonnull request, NSError * _Nullable error) {        NSArray *results = request.results;        if (!results.count) {            completion(CGRectZero);            return ;        }        //  è·å–ç»“æœ        VNFaceObservation *item = [self biggestObservationInArray:results];        CGRect rect = item.boundingBox;        //  æ ¹æ®æ¯”ä¾‹åç§»é‡è®¡ç®—åœ¨ View ä¸­çš„ä½ç½®        CGFloat x = rect.origin.x * imgW;        CGFloat y = rect.origin.y * imgH;        CGFloat w = rect.size.width * imgW;        CGFloat h = rect.size.height * imgH;        //  è¿”å›ç»“æœ, åæ ‡ç³»è½¬æ¢, yå€¼ç¿»è½¬        CGRect result = CGRectMake(x, imgH - y - h, w, h);        completion(result);    }];    [vnHandler performRequests:@[request] error:nil];}</code></pre><p>å…³äºä½¿ç”¨çš„é€»è¾‘å¾ˆæ¸…æ™°:</p><ul><li>ä½¿ç”¨ <code>CIImage</code> åˆ›å»ºä¸€ä¸ª <code>VNImageRequestHandler</code> å›¾ç‰‡è¯·æ±‚å¤„ç†å™¨</li><li>åˆ›å»º <code>VNDetectFaceRectanglesRequest</code> äººè„¸çŸ©å½¢åŒºåŸŸè¯†åˆ«çš„è¯·æ±‚</li><li>å¤„ç†å™¨ å¤„ç† è¯·æ±‚.</li></ul><p>å…³äºå¤„ç†å®Œæˆçš„ Block:</p><p>Vison è¿”å›çš„ç»“æœæ˜¯ä¸€ä¸ªæ•°ç»„, å› ä¸ºå›¾ç‰‡ä¸­å¯èƒ½ä¼šæœ‰å¤šä¸ªäººè„¸. é‚£ä¹ˆåŸºäºæˆ‘ä»¬çš„éœ€æ±‚, æˆ‘è¿™é‡Œå–äººè„¸åŒºåŸŸé¢ç§¯æœ€å¤§çš„äººè„¸è¿›è¡Œå¤„ç†. å¤„ç†æ—¶, æœ‰ä¸¤ç‚¹éœ€è¦æ³¨æ„:</p><ol><li><p>Vison çš„è¯†åˆ«ç»“æœ <code>VNFaceObservation</code> æ‰€è¿”å›çš„çŸ©å½¢åŒºåŸŸå®é™…ä¸Šå€¼éƒ½æ˜¯ç›¸å¯¹äºå›¾ç‰‡å®½é«˜çš„æ¯”ä¾‹, å‡è®¾å›¾ç‰‡å®½ 1000 åƒç´ , äººè„¸åŒºåŸŸå®½ 100 åƒç´ , åˆ™è¿”å›çš„ <code>CGRect</code> ä¸­ width å…¶å®ä¸º <strong>0.1</strong>, æˆ‘ä»¬éœ€è¦ä¹˜ä»¥å›¾ç‰‡çš„å®½ 1000 æ‰èƒ½å¾—åˆ°äººè„¸åŒºåŸŸçš„å®½ 100.</p></li><li><p><code>CoreImage</code> çš„åæ ‡ç³»å’Œ <code>UIKit</code> ä¸­çš„åæ ‡ç³»æ˜¯ä¸ä¸€æ ·çš„, ç›¸ä¿¡ä½¿ç”¨è¿‡ <code>CoreImage</code> çš„åŒå­¦éƒ½äº†è§£, åœ¨ <code>UIKit</code> ä¸­, åæ ‡åŸç‚¹æ˜¯åœ¨å±å¹•<strong>å·¦ä¸Šè§’</strong>, åœ¨ <code>CoreImage</code> ä¸­, åæ ‡åŸç‚¹æ˜¯åœ¨å±å¹•<strong>å·¦ä¸‹è§’</strong>, æˆ‘è¿™é‡Œå¸Œæœ›åæ ‡è½¬æ¢æˆç†Ÿæ‚‰çš„ <code>UIKit</code> ä¸­çš„åæ ‡ç³». è½¬æ¢å…³ç³»å¦‚å›¾:</p></li></ol><p><img src="https://user-gold-cdn.xitu.io/2017/12/25/1608d0e2abf60b9f?w=1024&amp;h=768&amp;f=jpeg&amp;s=118246" alt="åæ ‡è½¬æ¢"></p><p>ç®€å•æ¥è¯´, åªæœ‰ Y åæ ‡éœ€è¦è½¬æ¢, è®°ä¸€ä¸ªå…¬å¼ä¹Ÿå¯ä»¥ : <code>Y(UIKit) = æ€»é«˜ - Y(CoreImage) - åŒºåŸŸé«˜</code></p><p>è¿™æ ·å·²ç»å°è£…å¥½ä¸€ä¸ªæ ¹æ®ä¸€å¼ å›¾ç‰‡è¿”å›äººè„¸çŸ©å½¢åŒºåŸŸçš„æ–¹æ³•äº†.éå¸¸ç®€å•. é‚£ä¹ˆæˆ‘ä»¬åªè¦è·å–åˆ°æ‘„åƒå¤´æ•æ‰çš„å›¾ç‰‡, ç„¶åè°ƒç”¨åˆšåˆšå°è£…å¥½çš„æ–¹æ³•å°±å¯ä»¥äº†.</p><h3 id="è·å–ç¼“å†²å¸§ç…§ç‰‡"><a href="#è·å–ç¼“å†²å¸§ç…§ç‰‡" class="headerlink" title="è·å–ç¼“å†²å¸§ç…§ç‰‡"></a>è·å–ç¼“å†²å¸§ç…§ç‰‡</h3><p>å› ä¸º Vision æ¡†æ¶éœ€è¦çš„å›¾ç‰‡ç±»å‹æ˜¯ <code>CIImage</code>, æ‰€ä»¥æˆ‘è¿™åˆšåˆšè¯´çš„ä»£ç†æ–¹æ³•ä¸­, ç›´æ¥é€šè¿‡ç¼“å†²å¸§è·å¾—ä¸€ä¸ª <code>CIImage</code> çš„å¯¹è±¡.</p><pre><code class="objc">- (void)captureOutput:(AVCaptureOutput *)captureOutput didOutputSampleBuffer:(CMSampleBufferRef)sampleBuffer fromConnection:(AVCaptureConnection *)connection {    CVPixelBufferRef pixelBuffer = (CVPixelBufferRef)CMSampleBufferGetImageBuffer(sampleBuffer);    CIImage *ciImage = [CIImage imageWithCVPixelBuffer:pixelBuffer];    ...    [XYFaceHelper detectFaceRectWithImage:image completion:^(CGRect faceRect) {        ...    }];}</code></pre><h3 id="å®æ—¶æ˜¾ç¤ºäººè„¸æ¡†"><a href="#å®æ—¶æ˜¾ç¤ºäººè„¸æ¡†" class="headerlink" title="å®æ—¶æ˜¾ç¤ºäººè„¸æ¡†"></a>å®æ—¶æ˜¾ç¤ºäººè„¸æ¡†</h3><p>è·å–åˆ°äººè„¸çš„åŒºåŸŸ <code>CGRect</code> ä¹‹åå°±éå¸¸ç®€å•äº†. æ”¹å˜ä¹‹å‰åˆ›å»ºçš„äººè„¸é¢„è§ˆå±‚ <code>CGShapeLayer</code> çš„ <code>path</code> å³å¯.</p><p>å› ä¸ºå‰ç½®æ‘„åƒå¤´çœ‹è§çš„æˆ‘ä»¬æ˜¯é•œå­ä¸­çš„æˆ‘ä»¬, å’Œç°å®ä¸­çš„æˆ‘ä»¬æ˜¯é•œåƒå…³ç³», æ‰€ä»¥ç›¸æœºæ•è·åˆ°ç…§ç‰‡å, ä¼šåšä¸€ä¸ªæ°´å¹³ç¿»è½¬, æ‰€ä»¥</p><pre><code class="objc">        //  äººè„¸æ£€æµ‹        [XYFaceHelper detectFaceRectWithImage:image completion:^(CGRect faceRect) {            CGPathRef path;            if (faceRect.size.height &amp;&amp; faceRect.size.width) {                //  æ ¹æ®æ¯”ä¾‹åç§»é‡è®¡ç®—åœ¨ View ä¸­çš„ä½ç½®                CGFloat x = faceRect.origin.x - offsetX;                CGFloat y = faceRect.origin.y - offsetY;                CGFloat w = faceRect.size.width;                CGFloat h = faceRect.size.height;                //  åæ ‡ç³»è½¬æ¢, è‡ªæ‹ x å€¼ç¿»è½¬                CGRect drawRect = CGRectMake(viewW - x - w, y, w, h);                path = [UIBezierPath bezierPathWithRoundedRect:drawRect cornerRadius:7].CGPath;            } else {                path = nil;            }            //  ç»˜åˆ¶äººè„¸æ¡†æ¡†            dispatch_sync(dispatch_get_main_queue(), ^{                self.faceShapeLayer.path = path;            });        }];</code></pre><h2 id="ç‰¹å¾ç‚¹æå–"><a href="#ç‰¹å¾ç‚¹æå–" class="headerlink" title="ç‰¹å¾ç‚¹æå–"></a>ç‰¹å¾ç‚¹æå–</h2><h2 id="ç›¸ä¼¼åº¦åŒ¹é…"><a href="#ç›¸ä¼¼åº¦åŒ¹é…" class="headerlink" title="ç›¸ä¼¼åº¦åŒ¹é…"></a>ç›¸ä¼¼åº¦åŒ¹é…</h2><h2 id="è¡¨æƒ…åŒ…åˆ¶ä½œ"><a href="#è¡¨æƒ…åŒ…åˆ¶ä½œ" class="headerlink" title="è¡¨æƒ…åŒ…åˆ¶ä½œ"></a>è¡¨æƒ…åŒ…åˆ¶ä½œ</h2>]]></content>
      
      
    </entry>
    
    <entry>
      <title>GitHub ä¸ªäººåšå®¢æ­å»º</title>
      <link href="/2018/05/02/helloworld/"/>
      <url>/2018/05/02/helloworld/</url>
      <content type="html"><![CDATA[<h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><h3 id="Node-js"><a href="#Node-js" class="headerlink" title="Node.js"></a>Node.js</h3><p><a href="https://nodejs.org/en/download/" target="_blank" rel="noopener">ä¸‹è½½ node.js</a></p><h3 id="Hexo"><a href="#Hexo" class="headerlink" title="Hexo"></a>Hexo</h3><p><a href="https://hexo.io/docs/" target="_blank" rel="noopener">å®‰è£… hexo</a></p><p>æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</p><pre><code>npm install -g hexo-cli</code></pre><p>æˆ‘è¿™é‡Œå®‰è£…æŠ¥é”™äº†. åŸå› æ˜¯å®‰è£…å…¨å±€æ¨¡å—æ²¡æœ‰æƒé™</p><p><a href="https://blog.csdn.net/gentlycare/article/details/51279529" target="_blank" rel="noopener">å‚ç…§è¿™ä¸ªè§£å†³æ–¹æ¡ˆ</a></p><p>é€‰æ‹©äº†ä¿®æ”¹å…¨å±€å®‰è£…è·¯å¾„çš„æ–¹æ³•:</p><p>åˆ›å»ºä¸€ä¸ªé»˜è®¤çš„å®‰è£…è·¯å¾„</p><pre><code>mkdir ~/.npm-global</code></pre><p>ä¿®æ”¹npmé»˜è®¤é…ç½®</p><pre><code>npm config set prefix &#39;~/.npm-global&#39;</code></pre><p>é…ç½®ç¯å¢ƒå˜é‡, ç”±äºæˆ‘ä½¿ç”¨çš„æ˜¯ <code>zsh</code>, æ‰€ä»¥ç¼–è¾‘</p><pre><code>vi ~/.zshrc</code></pre><p>å¢åŠ ä¸€è¡Œ</p><pre><code>export PATH=~/.npm-global/bin:$PATH</code></pre><p>ä¹‹å</p><pre><code>source ~/.zshrc</code></pre><h2 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h2><h3 id="GitHub-é…ç½®ä»“åº“"><a href="#GitHub-é…ç½®ä»“åº“" class="headerlink" title="GitHub é…ç½®ä»“åº“"></a>GitHub é…ç½®ä»“åº“</h3><p>å¿…é¡»ä½¿ç”¨ <code>username.github.io</code> çš„å‘½å, å¦‚æˆ‘çš„ <code>hanyx1992.github.io</code></p><h3 id="æœ¬åœ°"><a href="#æœ¬åœ°" class="headerlink" title="æœ¬åœ°"></a>æœ¬åœ°</h3><p>åœ¨æœ¬åœ°é€‰æ‹©å®‰ç¨³çš„åœ°æ–¹åˆ›å»ºæ–‡ä»¶å¤¹ä½œä¸ºè‡ªå·±çš„åšå®¢å·¥ç¨‹, åœ¨ç›®å½•ä¸­æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤æ¥è¿›è¡Œåˆå§‹åŒ–</p><pre><code>hexo initnpm installnpm install hexo-deployer-git --save</code></pre><h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><h3 id="ä¸»é¢˜"><a href="#ä¸»é¢˜" class="headerlink" title="ä¸»é¢˜"></a>ä¸»é¢˜</h3><p>æˆ‘é€‰æ‹©äº†<a href="https://material.viosey.com/docs/#/start" target="_blank" rel="noopener">Material</a></p><ol><li><p><a href="https://github.com/viosey/hexo-theme-material/releases" target="_blank" rel="noopener">ä¸‹è½½äº†æœ€æ–°çš„åŒ…</a>å¹¶è§£å‹ç¼©.</p></li><li><p>å°†æ•´ä¸ªæ–‡ä»¶å¤¹å‘½åä¸º <code>material</code></p></li><li><p>ç§»åŠ¨åˆ°å·¥ç¨‹ç›®å½• <code>åšå®¢/themes/</code> ä¸­</p></li><li><p>å°†ä¸»é¢˜é…ç½® <code>åšå®¢/themes/material/_config.template.yml</code> æ”¹åä¸º <code>_config.yml</code> ä»¥ä¾¿ç”Ÿæ•ˆ</p></li><li><p>ä¿®æ”¹åšå®¢é…ç½® <code>åšå®¢/_config.yml</code> ä¸­çš„ <code>theme</code> ä¸»é¢˜å­—æ®µå€¼ä¸º <code>material</code></p></li></ol><p><a href="https://material.viosey.com/docs/#/start" target="_blank" rel="noopener">ä¸»é¢˜é…ç½®å¯å‚ç…§ Material è¯¦ç»†æ–‡æ¡£</a></p><h3 id="å…¨å±€é…ç½®"><a href="#å…¨å±€é…ç½®" class="headerlink" title="å…¨å±€é…ç½®"></a>å…¨å±€é…ç½®</h3><p>ä¿®æ”¹åšå®¢é…ç½® <code>åšå®¢/_config.yml</code> ä¸­æ¥å…³è” GitHub ä»“åº“</p><pre><code>deploy:  type: git  repository: https://github.com/hanyx1992/hanyx1992.github.io.git  branch: master</code></pre><p><a href="https://hexo.io/docs/configuration.html" target="_blank" rel="noopener">å…¶ä»–é…ç½®å¯å‚ç…§ Hexo è¯¦ç»†æ–‡æ¡£</a></p><h3 id="ä»£ç é«˜äº®"><a href="#ä»£ç é«˜äº®" class="headerlink" title="ä»£ç é«˜äº®"></a>ä»£ç é«˜äº®</h3><p>hexo è‡ªå¸¦çš„ä»£ç é«˜äº®å‡ ä¹æ²¡æœ‰ä»€ä¹ˆæ•ˆæœ, æˆ‘è¿™é‡Œä½¿ç”¨äº†<a href="https://github.com/google/code-prettify" target="_blank" rel="noopener">Google-code-prettify</a>.</p><h4 id="ç¦ç”¨é»˜è®¤é«˜äº®æ’ä»¶"><a href="#ç¦ç”¨é»˜è®¤é«˜äº®æ’ä»¶" class="headerlink" title="ç¦ç”¨é»˜è®¤é«˜äº®æ’ä»¶"></a>ç¦ç”¨é»˜è®¤é«˜äº®æ’ä»¶</h4><p>åœ¨ <code>åšå®¢/_config.yml</code> ä¸­å°† highlight æ’ä»¶ç¦ç”¨, æ‰¾åˆ°å¦‚ä¸‹éƒ¨åˆ†éƒ½æ”¹æˆ false å³å¯</p><pre><code>highlight:  enable: false  line_number: false  auto_detect: false  tab_replace:</code></pre><h4 id="é…ç½®é«˜äº®é£æ ¼"><a href="#é…ç½®é«˜äº®é£æ ¼" class="headerlink" title="é…ç½®é«˜äº®é£æ ¼"></a>é…ç½®é«˜äº®é£æ ¼</h4><p>åœ¨æœ€æ–°ç‰ˆæœ¬ 1.5.6 çš„ Material ä¸­å·²ç»é›†æˆäº† prettify, æ— éœ€å¼•å…¥äº†. åªéœ€è¦åœ¨ä¸»é¢˜é…ç½® <code>åšå®¢/themes/material/_config.yml</code> ä¸­, æ‰¾åˆ°ä»¥ä¸‹åœ°æ–¹, ä¿®æ”¹ <code>enable</code> ä¸º <code>true</code> å³å¯</p><pre><code>prettify:  enable: true  theme: &quot;tranquil-heart&quot;</code></pre><p>Material ä¸­çš„ Prettify ä¸»é¢˜åœ¨ç›®å½• <code>material/source/css/prettify</code> ä¸­, é…ç½®åªéœ€è¦åŠ åç§°å³å¯, ä¸éœ€è¦åŠ  <code>.min.css</code> , æˆ‘è¿™é‡Œéšä¾¿é€‰æ‹©äº† tranquil-heart.</p><h2 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h2><pre><code>//ç”Ÿæˆæ–‡ä»¶hexo g//æœ¬åœ°æœåŠ¡é¢„è§ˆhexo s//éƒ¨ç½²åˆ°GitHubhexo d</code></pre><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://zhuanlan.zhihu.com/p/32957389" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/32957389</a></p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>iOS 0è¡Œä»£ç å®ç° TableView æ— æ•°æ®æ—¶å±•ç¤ºå ä½è§†å›¾</title>
      <link href="/2017/12/21/tableview-nodata-view/"/>
      <url>/2017/12/21/tableview-nodata-view/</url>
      <content type="html"><![CDATA[<h2 id="å‰é¢"><a href="#å‰é¢" class="headerlink" title="å‰é¢"></a>å‰é¢</h2><p>ç›®å‰é¡¹ç›®åŠŸèƒ½åšçš„å·®ä¸å¤šäº†. éœ€è¦å®Œå–„å’Œæ‰“ç£¨, ä»Šå¤©éœ€è¦ä¸ºæ‰€æœ‰çš„ TableView åˆ—è¡¨é¡µæ²¡æœ‰æ•°æ®çš„æ—¶å€™å±•ç¤ºä¸€ä¸ªå‹å¥½çš„æç¤ºè§†å›¾, ä¸€ä¸ªä¸€ä¸ªæ”¹å¤ªéº»çƒ¦äº†. è€Œä¸”ä¸šåŠ¡é€»è¾‘çƒ¦æ‚æ”¹èµ·æ¥ä¹Ÿä¸å®¹æ˜“. æ‰€ä»¥èŠ±äº†ç‚¹æ—¶é—´å†™äº†ä¸€ä¸ªå°ä¸œè¥¿.åœ¨é¡¹ç›®ä¸­æŒ‰ç…§é¡¹ç›®çš„è§„èŒƒå‰ç¼€ä½¿ç”¨äº†<code>AN</code>, è‡ªå·±æå–å‡ºæ¥è¿˜æ˜¯æŒ‰ç…§è‡ªå·±çš„å–œå¥½å°†å‰ç¼€æ”¹ä¸ºäº†<code>XY</code>.</p><h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><p><a href="https://github.com/hanyx1992/XYTableViewNoDataView" target="_blank" rel="noopener">å›½é™…æƒ¯ä¾‹, å…ˆä¸Š Demo</a><br><img src="https://user-gold-cdn.xitu.io/2017/12/13/1604db054a370ab5?w=480&amp;h=921&amp;f=gif&amp;s=341232" alt="Demoæ•ˆæœ"></p><h2 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h2><ul><li>æ‹–æ‹½å³å¯ä½¿ç”¨, æ— éœ€ import , å¯¹åŸæœ‰ä»£ç æ— éœ€è¿›è¡Œä»»ä½•ä¿®æ”¹</li><li>ä¹Ÿå¯ä»¥é€‰æ‹©å®ç°æ–¹æ³•, å®ç°å¿«æ·çš„è‡ªå®šä¹‰å’Œå®Œå…¨çš„è‡ªå®šä¹‰</li></ul><h2 id="æ„Ÿè°¢"><a href="#æ„Ÿè°¢" class="headerlink" title="æ„Ÿè°¢"></a>æ„Ÿè°¢</h2><p>ä»Šå¤©æœç´¢åˆ°äº†è¿™ç¯‡æ–‡ç« , ä¹Ÿæ˜¯æˆ‘çš„æ€è·¯æ¥æº.<br><a href="http://www.jianshu.com/p/e39699b0d134" target="_blank" rel="noopener">UITableViewæ²¡æ•°æ®æ—¶ç”¨æˆ·æç¤ºå¦‚ä½•åš</a></p><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><h3 id="æ— å…¥ä¾µ"><a href="#æ— å…¥ä¾µ" class="headerlink" title="æ— å…¥ä¾µ"></a>æ— å…¥ä¾µ</h3><p>ä½¿ç”¨ Runtime äº¤æ¢æ–¹æ³•å®ç°å¯¹åŸæœ‰ä»£ç æ— å…¥ä¾µ.<br>åˆ›å»ºä¸€ä¸ª TableView çš„åˆ†ç±», åœ¨ .m ä¸­</p><pre><code class="objc">#import &lt;objc/runtime.h&gt;</code></pre><p>ç›®å‰æˆ‘æƒ³åˆ°çš„æ€è·¯æ˜¯åœ¨ <code>reloadData</code> çš„æ—¶å€™è¿›è¡Œå®ç°, æ‰€ä»¥å®šä¹‰ä¸€ä¸ª<br><code>xy_reloadData</code> æ–¹æ³•, ç„¶åå’ŒåŸæœ‰çš„ <code>reloadData</code> æ–¹æ³•è¿›è¡Œäº¤æ¢. </p><p>ä¹Ÿå°±æ˜¯è¯´:</p><ul><li>åœ¨ä»£ç ä¸­æ‰€æœ‰è°ƒç”¨ <code>reloadData</code> çš„æ–¹æ³•æœ€ç»ˆä¼šè°ƒç”¨æˆ‘ä»¬è‡ªå®šä¹‰çš„ <code>xy_reloadData</code> æ–¹æ³•.</li><li>æˆ‘ä»¬ <code>xy_reloadData</code> æ–¹æ³•ä¸­, å¦‚æœæƒ³è°ƒç”¨ç³»ç»Ÿçš„ <code>reloadData</code> æ–¹æ³•, åˆ™éœ€è¦è°ƒç”¨ <code>xy_reloadData</code> æ–¹æ³•.</li></ul><pre><code class="objc">+ (void)load {    Method reloadData    = class_getInstanceMethod(self, @selector(reloadData));    Method xy_reloadData = class_getInstanceMethod(self, @selector(xy_reloadData));    method_exchangeImplementations(reloadData, xy_reloadData);}</code></pre><p>å¯¹ load æ–¹æ³•çš„æè¿°æ˜¯</p><blockquote><p>Invoked whenever a class or category is added to the Objective-C runtime; implement this method to perform class-specific behavior upon loading.<br>å½“ä¸€ä¸ª <strong>ç±»</strong> æˆ– <strong>åˆ†ç±»</strong> æ·»åŠ åˆ° <strong>Objective-C Runtime</strong> æ—¶ï¼›å®ç°è¿™ä¸ªæ–¹æ³•æ¥åŠ è½½åæ‰§è¡Œç‰¹å®šç±»çš„è¡Œä¸ºã€‚</p></blockquote><p>æ‰€ä»¥å¯ä»¥å®ç°æ— éœ€ import å°±å¯ä»¥å®ç°åŠ è½½.</p><h3 id="è·å–-TableView-çš„æ•°æ®é‡"><a href="#è·å–-TableView-çš„æ•°æ®é‡" class="headerlink" title="è·å– TableView çš„æ•°æ®é‡"></a>è·å– TableView çš„æ•°æ®é‡</h3><p>TableView æœ‰å¯èƒ½æœ‰å¤šä¸ª Sections æ¯ä¸ª Section éƒ½æœ‰å¯èƒ½æœ‰å¾ˆå¤š Cell. æ‰€ä»¥ä¸èƒ½å•å•åˆ¤æ–­ç¬¬ä¸€ä¸ª Section æ˜¯å¦æœ‰æ•°æ®. æ‰€ä»¥è¦:</p><ul><li>è·å– Section çš„æ•°é‡</li><li>è·å–æ¯ä¸€ä¸ª Section å½“ä¸­ Cell çš„æ•°é‡</li></ul><pre><code class="objc">    NSInteger numberOfSections = [self numberOfSections];    BOOL havingData = NO;    for (NSInteger i = 0; i &lt; numberOfSections; i++) {        if ([self numberOfRowsInSection:i] &gt; 0) {            havingData = YES;            break;        }    }</code></pre><p>è¿™æ ·è¿™ä¸ªå¸ƒå°”å€¼ havingData å³æ˜¯æ˜¯å¦æœ‰æ•°æ®çš„æ ‡è®°.</p><h3 id="å¦‚ä½•å®ç°-reloadData-å®Œæˆä¹‹åå†è·å–æ•°é‡"><a href="#å¦‚ä½•å®ç°-reloadData-å®Œæˆä¹‹åå†è·å–æ•°é‡" class="headerlink" title="å¦‚ä½•å®ç° reloadData å®Œæˆä¹‹åå†è·å–æ•°é‡."></a>å¦‚ä½•å®ç° reloadData å®Œæˆä¹‹åå†è·å–æ•°é‡.</h3><p>å› ä¸º TableView çš„ reloadData æ–¹æ³•å…·ä½“å®ç°æ˜¯å¼‚æ­¥çš„.æƒ³è¦è·å–åˆ°åŠ è½½å®Œæˆçš„çŠ¶æ€æœ‰ä¸¤ç§æ–¹æ³•</p><ol><li>ä½¿ç”¨ <code>layoutIfNeeded</code> æ–¹æ³•</li><li>è·å–<code>ä¸»é˜Ÿåˆ—</code>å¼‚æ­¥æ‰§è¡Œ</li></ol><p>ç¬¬ä¸€ç§æ–¹æ³•å®ç°ä»£ç ä¸º:</p><pre><code class="objc">    [self xy_reloadData];    [self layoutIfNeeded];    //æ¥ä¸‹æ¥çš„ä»£ç </code></pre><p>è¿™æ ·çš„è¯çº¿ç¨‹ä¼šä¸€ç›´é˜»å¡, å½“ç„¶æˆ‘ä»¬ä¸å¸Œæœ›<strong>åŸæ¥ä¸šåŠ¡ä»£ç ä¸­çš„ reloadData ä¼šé˜»å¡, ç›´åˆ°åŠ è½½å®Œæˆä¹‹åå†ç»§ç»­æ‰§è¡Œä»£ç </strong>.</p><p>æ‰€ä»¥æˆ‘é€‰æ‹©ç¬¬äºŒç§æ–¹æ³•</p><pre><code class="objc">    [self xy_reloadData];    dispatch_async(dispatch_get_main_queue(), ^{        //æ¥ä¸‹æ¥çš„ä»£ç     });</code></pre><p>é‚£ä¹ˆæˆ‘ä»¬ <code>xy_reloadData</code> ä¸­çš„æ–¹æ³•å®ç°ä¸º:</p><pre><code class="objc">- (void)xy_reloadData {    [self xy_reloadData];    //  åˆ·æ–°å®Œæˆä¹‹åæ£€æµ‹æ•°æ®é‡    dispatch_async(dispatch_get_main_queue(), ^{        NSInteger numberOfSections = [self numberOfSections];        BOOL havingData = NO;        for (NSInteger i = 0; i &lt; numberOfSections; i++) {            if ([self numberOfRowsInSection:i] &gt; 0) {                havingData = YES;                break;            }        }        [self xy_havingData:havingData];    });}</code></pre><h3 id="å±•ç¤ºä¸€ä¸ªå ä½è§†å›¾"><a href="#å±•ç¤ºä¸€ä¸ªå ä½è§†å›¾" class="headerlink" title="å±•ç¤ºä¸€ä¸ªå ä½è§†å›¾"></a>å±•ç¤ºä¸€ä¸ªå ä½è§†å›¾</h3><p>TableView æœ‰ä¸€ä¸ª backgroundView çš„å±æ€§å¯ä»¥å¾ˆå¥½çš„èƒœä»»è¿™ä¸ªéœ€æ±‚<br>å¯ä»¥æ ¹æ® havingData çš„çŠ¶æ€æ¥è¿›è¡Œèµ‹å€¼</p><pre><code class="objc">- (void)xy_havingData:(BOOL)havingData {    if (havingData) {        self.backgroundView = nil;    } else {        self.backgroundView = è‡ªå®šä¹‰è§†å›¾;    }}</code></pre><h3 id="å¦‚ä½•è®©æ§åˆ¶å™¨è‡ªå®šä¹‰è§†å›¾"><a href="#å¦‚ä½•è®©æ§åˆ¶å™¨è‡ªå®šä¹‰è§†å›¾" class="headerlink" title="å¦‚ä½•è®©æ§åˆ¶å™¨è‡ªå®šä¹‰è§†å›¾"></a>å¦‚ä½•è®©æ§åˆ¶å™¨è‡ªå®šä¹‰è§†å›¾</h3><p>å½“ç„¶æˆ‘ä»¬ä¸æ»¡è¶³äºç®€ç®€å•å•çš„è§†å›¾çš„éœ€æ±‚, æˆ‘ä»¬å¸Œæœ›å¯¹åº”çš„æ§åˆ¶å™¨å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚è‡ªå®šä¹‰è‡ªå·±çš„è§†å›¾.</p><p>æˆ‘ä»¬æœ€ä¹ æƒ¯çš„æ–¹æ³•å½“ç„¶æ˜¯åœ¨ TableView çš„ä»£ç†ç±»(é€šå¸¸æ˜¯æ§åˆ¶å™¨)ä¸­å»å¤„ç† TableView çš„ä¸€äº›é€»è¾‘</p><p>é‚£ä¹ˆå‡è®¾æˆ‘ä»¬å¸Œæœ›ä»£ç†ç±»å®ç°ä¸€ä¸ªæ–¹æ³• <code>xy_noDataView</code></p><pre><code class="objc">    if ([self.delegate respondsToSelector:@selector(xy_noDataView)]) {        self.backgroundView = [self.delegate performSelector:@selector(xy_noDataView)];        return ;    }</code></pre><p>è¿™ä¸ªåœ°æ–¹ä¼šæœ‰ä¸€ä¸ªç¼–è¯‘è­¦å‘Š, æˆ‘é€‰æ‹©åœ¨ .m æ–‡ä»¶ä¸­å®šä¹‰ä¸€ä¸ª protocol æ¥æ¶ˆé™¤, æˆ‘è¿˜å®šä¹‰äº†ä¸€äº›å…¶ä»–çš„æ–¹æ³•æ¥æ›´å¥½çš„å®Œæˆæˆ‘çš„éœ€æ±‚.</p><pre><code class="objc">/** æ¶ˆé™¤è­¦å‘Š */@protocol XYTableViewDelegate &lt;NSObject&gt;@optional- (UIView   *)xy_noDataView;                //  å®Œå…¨è‡ªå®šä¹‰å ä½å›¾- (UIImage  *)xy_noDataViewImage;           //  ä½¿ç”¨é»˜è®¤å ä½å›¾, æä¾›ä¸€å¼ å›¾ç‰‡,    å¯ä¸æä¾›, é»˜è®¤ä¸æ˜¾ç¤º- (NSString *)xy_noDataViewMessage;         //  ä½¿ç”¨é»˜è®¤å ä½å›¾, æä¾›æ˜¾ç¤ºæ–‡å­—,    å¯ä¸æä¾›, é»˜è®¤ä¸ºæš‚æ— æ•°æ®- (UIColor  *)xy_noDataViewMessageColor;    //  ä½¿ç”¨é»˜è®¤å ä½å›¾, æä¾›æ˜¾ç¤ºæ–‡å­—é¢œè‰², å¯ä¸æä¾›, é»˜è®¤ä¸ºç°è‰²- (NSNumber *)xy_noDataViewCenterYOffset;   //  ä½¿ç”¨é»˜è®¤å ä½å›¾, CenterY å‘ä¸‹çš„åç§»é‡@end</code></pre><p>ä¹‹æ‰€ä»¥æ²¡æœ‰åœ¨. h ä¸­å£°æ˜, ç„¶åè¦æ±‚æ§åˆ¶å™¨å®ç°æˆ‘ä»¬çš„ä»£ç†, ç„¶ååœ¨å»å®ç°æ–¹æ³•æ˜¯æƒ³å°½å¯èƒ½çš„æ— ä¾µå…¥, å¥‘çº¦å¼ç¼–ç¨‹, æŒ‰è§„åˆ™å®ç°æ–¹æ³•æ—¢å¯ä»¥ç”Ÿæ•ˆ.</p><p>æˆ‘å¸Œæœ›èƒ½å®ç° <strong>æ‹–æ¥å³ç”¨, æƒ³æ‰”å°±æ‰”</strong></p><p>æˆ‘è¿˜å®ç°äº†ä¸€äº›ç®€å•çš„åŠŸèƒ½. è¯¦ç»†çš„å¯ä»¥æŸ¥çœ‹ Demo.</p><p>å®Œæ•´çš„<code>xy_havingData</code>æ–¹æ³•å¦‚ä¸‹:</p><pre><code class="objc">- (void)xy_havingData:(BOOL)havingData {    //  ä¸éœ€è¦æ˜¾ç¤ºå ä½å›¾    if (havingData) {        self.backgroundView = nil;        return ;    }    //  ä¸éœ€è¦é‡å¤åˆ›å»º    if (self.backgroundView) {        return ;    }    //  è‡ªå®šä¹‰äº†å ä½å›¾    if ([self.delegate respondsToSelector:@selector(xy_noDataView)]) {        self.backgroundView = [self.delegate performSelector:@selector(xy_noDataView)];        return ;    }    //  ä½¿ç”¨è‡ªå¸¦çš„    UIImage  *img   = nil;    NSString *msg   = @&quot;æš‚æ— æ•°æ®&quot;;    UIColor  *color = [UIColor lightGrayColor];    CGFloat  offset = 0;    //  è·å–å›¾ç‰‡    if ([self.delegate    respondsToSelector:@selector(xy_noDataViewImage)]) {        img = [self.delegate performSelector:@selector(xy_noDataViewImage)];    }    //  è·å–æ–‡å­—    if ([self.delegate    respondsToSelector:@selector(xy_noDataViewMessage)]) {        msg = [self.delegate performSelector:@selector(xy_noDataViewMessage)];    }    //  è·å–é¢œè‰²    if ([self.delegate      respondsToSelector:@selector(xy_noDataViewMessageColor)]) {        color = [self.delegate performSelector:@selector(xy_noDataViewMessageColor)];    }    //  è·å–åç§»é‡    if ([self.delegate        respondsToSelector:@selector(xy_noDataViewCenterYOffset)]) {        offset = [[self.delegate performSelector:@selector(xy_noDataViewCenterYOffset)] floatValue];    }    //  åˆ›å»ºå ä½å›¾    self.backgroundView = [self xy_defaultNoDataViewWithImage  :img message:msg color:color offsetY:offset];}</code></pre><p>å®ç°äº†, å¯ä»¥é€šè¿‡å®Œå…¨è‡ªå®šä¹‰ View çš„æ–¹æ³•å®ç°å®Œå…¨è‡ªå®šä¹‰, ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå¸¦çš„ä¸€äº›æ ·å¼, æŒ‡å®š<strong>å›¾ç‰‡</strong>, <strong>æ–‡å­—</strong>, <strong>æ–‡å­—é¢œè‰²</strong>, ä»¥åŠ<strong>ä½ç½®åç§»é‡</strong>, å½“ç„¶<strong>å…¶ä¸­ä»»ä½•ä¸€ä¸ªéƒ½æ˜¯å¯ä»¥ä¸æŒ‡å®šçš„, ä½¿ç”¨é»˜è®¤è®¾å®š</strong>.</p><p>ç•Œé¢çš„ä¸€äº›ä»£ç </p><pre><code class="objc">/** é»˜è®¤çš„å ä½å›¾ */- (UIView *)xy_defaultNoDataViewWithImage:(UIImage *)image message:(NSString *)message color:(UIColor *)color offsetY:(CGFloat)offset {    //  è®¡ç®—ä½ç½®, å‚ç›´å±…ä¸­, å›¾ç‰‡é»˜è®¤ä¸­å¿ƒåä¸Š.    CGFloat sW = self.bounds.size.width;    CGFloat cX = sW / 2;    CGFloat cY = self.bounds.size.height * (1 - 0.618) + offset;    CGFloat iW = image.size.width;    CGFloat iH = image.size.height;    //  å›¾ç‰‡    UIImageView *imgView = [[UIImageView alloc] init];    imgView.frame        = CGRectMake(cX - iW / 2, cY - iH / 2, iW, iH);    imgView.image        = image;    //  æ–‡å­—    UILabel *label       = [[UILabel alloc] init];    label.font           = [UIFont systemFontOfSize:17];    label.textColor      = color;    label.text           = message;    label.textAlignment  = NSTextAlignmentCenter;    label.frame          = CGRectMake(0, CGRectGetMaxY(imgView.frame) + 24, sW, label.font.lineHeight);    //  è§†å›¾    XYNoDataView *view   = [[XYNoDataView alloc] init];    [view addSubview:imgView];    [view addSubview:label];    //  å®ç°è·Ÿéš TableView æ»šåŠ¨    [view addObserver:self forKeyPath:kXYNoDataViewObserveKeyPath options:NSKeyValueObservingOptionNew context:nil];    return view;}</code></pre><h3 id="ç»†èŠ‚ä¼˜åŒ–"><a href="#ç»†èŠ‚ä¼˜åŒ–" class="headerlink" title="ç»†èŠ‚ä¼˜åŒ–"></a>ç»†èŠ‚ä¼˜åŒ–</h3><h4 id="å¦‚ä½•å®ç°é¡µé¢åŠ è½½çš„æ—¶å€™ä¸å±•ç¤ºå ä½å›¾"><a href="#å¦‚ä½•å®ç°é¡µé¢åŠ è½½çš„æ—¶å€™ä¸å±•ç¤ºå ä½å›¾" class="headerlink" title="å¦‚ä½•å®ç°é¡µé¢åŠ è½½çš„æ—¶å€™ä¸å±•ç¤ºå ä½å›¾"></a>å¦‚ä½•å®ç°é¡µé¢åŠ è½½çš„æ—¶å€™ä¸å±•ç¤ºå ä½å›¾</h4><p>åœ¨ TableView æ˜¾ç¤ºåˆ°ç•Œé¢ä¸Šæ—¶, ç›¸å½“äºè°ƒç”¨äº† <code>reloadData</code> æ–¹æ³•, æ‰€ä»¥æŒ‰ç…§æˆ‘ä»¬ç›®å‰çš„é€»è¾‘ä¼šå…ˆå±•ç¤ºä¸€ä¸ªå ä½å›¾, ç„¶åæ•°æ®åŠ è½½å®Œæˆå, å†æ¬¡è°ƒç”¨ <code>reloadData</code> æ–¹æ³•ä»¥éšè—å ä½å›¾. </p><p>æ•°æ®åŠ è½½ä¹‹å‰, æˆ‘ä»¬è‚¯å®šä¸å¸Œæœ›å±•ç¤ºæ— æ•°æ®çš„å ä½å›¾, å› ä¸ºå¾ˆæœ‰å¯èƒ½æ˜¯æœ‰æ•°æ®çš„, æ‰€ä»¥å¯ä»¥å¿½ç•¥æ‰ç¬¬ä¸€æ¬¡è°ƒç”¨ <code>reloadData</code> çš„å¤„ç†, åœ¨ <code>xy_reloadData</code> æ–¹æ³•ä¸­å¢åŠ å¦‚ä¸‹æ ¡éªŒåœ¨ <code>[self xy_reloadData];</code> ä¹‹å, å¦‚æœæ²¡æœ‰åŠ è½½å®Œæˆæ•°æ®æ—¶, æˆ‘ä»¬é»˜è®¤å½“åšæœ‰æ•°æ®å»å¤„ç†, å³ç›¸å½“äºå ä½å›¾ä¸æ˜¾ç¤º. ç„¶åè®°å½•ä¸€ä¸‹, æ•°æ®å·²ç»åŠ è½½å®Œæˆäº†. </p><pre><code class="objc">    //  å¿½ç•¥ç¬¬ä¸€æ¬¡åŠ è½½    if (![self isInitFinish]) {        [self xy_havingData:YES];        [self setIsInitFinish:YES];        return ;    }</code></pre><p>ä¸º TableView ç»‘å®šä¸€ä¸ªå±æ€§ç”¨æ¥è®°å½•æ˜¯å¦å·²ç»åŠ è½½å®Œ</p><pre><code class="objc">/** è®¾ç½®å·²ç»åŠ è½½å®Œæˆæ•°æ®äº† */- (void)setIsInitFinish:(BOOL)finish {    objc_setAssociatedObject(self, @selector(isInitFinish), @(finish), OBJC_ASSOCIATION_RETAIN_NONATOMIC);}/** æ˜¯å¦å·²ç»åŠ è½½å®Œæˆæ•°æ® */- (BOOL)isInitFinish {    id obj = objc_getAssociatedObject(self, _cmd);    return [obj boolValue];}</code></pre><h4 id="æ»šåŠ¨æ—¶å¦‚ä½•è®©å ä½å›¾è·Ÿéš-TableView-çš„æ»šåŠ¨è€Œæ»šåŠ¨"><a href="#æ»šåŠ¨æ—¶å¦‚ä½•è®©å ä½å›¾è·Ÿéš-TableView-çš„æ»šåŠ¨è€Œæ»šåŠ¨" class="headerlink" title="æ»šåŠ¨æ—¶å¦‚ä½•è®©å ä½å›¾è·Ÿéš TableView çš„æ»šåŠ¨è€Œæ»šåŠ¨."></a>æ»šåŠ¨æ—¶å¦‚ä½•è®©å ä½å›¾è·Ÿéš TableView çš„æ»šåŠ¨è€Œæ»šåŠ¨.</h4><p>å› ä¸ºæˆ‘ä»¬çš„å ä½å›¾æ˜¯èµ‹å€¼åœ¨ TableView çš„ <code>backgroundView</code> å±æ€§ä¸Šçš„, ç›¸å½“äºå¢åŠ åˆ°äº† TableView ä¸Š, é€šè¿‡è°ƒè¯•å¯ä»¥å‘ç°, åœ¨ TableView æ»šåŠ¨ <code>contentOffset</code> æ”¹å˜æ—¶, <code>backgroundView</code> çš„<code>frame.origin.y</code>ä¹Ÿæ˜¯åŒæ­¥æ”¹å˜çš„, æ‰€ä»¥æˆ‘ä»¬çœ‹èµ·æ¥æ— è®º TableView æ€ä¹ˆæ»šåŠ¨å ä½å›¾éƒ½æ˜¯æ— åŠ¨äºè¡·çš„, å¦‚æœæˆ‘ä»¬æƒ³è®©å ä½å›¾è·Ÿéšæ»šåŠ¨çš„è¯, åªè¦å–æ¶ˆæ‰<code>backgroundView</code> çš„ <code>frame.origin.y</code> çš„åŒæ­¥æ›´æ–°å°±å¥½äº†, <strong>ä¹Ÿå°±æ˜¯è¯´è¦ä¿è¯ <code>frame.origin.y</code> çš„å€¼ä¸€ç›´ä¸º0.</strong></p><p>æˆ‘è¿™é‡Œæ²¡æœ‰æ‰¾åˆ°æ›´å¥½çš„åŠæ³•, æš‚æ—¶ä½¿ç”¨ KVO æ¥å®ç°, è®°å¾— View é”€æ¯çš„æ—¶å€™è¦ç§»é™¤ KVO çš„ç›‘å¬, è¯¦ç»†å®ç°å¯ä»¥çœ‹ Demo å•¦â€¦</p><pre><code class="objc">- (void)observeValueForKeyPath:(NSString *)keyPath ofObject:(id)object change:(NSDictionary&lt;NSKeyValueChangeKey,id&gt; *)change context:(void *)context {    if ([keyPath isEqualToString:kXYNoDataViewObserveKeyPath]) {        /**         åœ¨ TableView æ»šåŠ¨ ContentOffset æ”¹å˜æ—¶, ä¼šåŒæ­¥æ”¹å˜ backgroundView çš„ frame.origin.y         å¯ä»¥å®ç°, backgroundView ä½ç½®ç›¸å¯¹äº TableView ä¸åŠ¨, ä½†æ˜¯æˆ‘ä»¬å¸Œæœ›         backgroundView è·Ÿéš TableView çš„æ»šåŠ¨è€Œæ»šåŠ¨, åªèƒ½å¼ºåˆ¶è®¾ç½® frame.origin.y æ°¸è¿œä¸º 0         å…¼å®¹ MJRefresh         */        CGRect frame = [[change objectForKey:NSKeyValueChangeNewKey] CGRectValue];        if (frame.origin.y != 0) {            frame.origin.y  = 0;            self.backgroundView.frame = frame;        }    }}</code></pre><h3 id="å¦‚æœä¸æƒ³æ˜¾ç¤ºå ä½å›¾æ€ä¹ˆåŠ"><a href="#å¦‚æœä¸æƒ³æ˜¾ç¤ºå ä½å›¾æ€ä¹ˆåŠ" class="headerlink" title="å¦‚æœä¸æƒ³æ˜¾ç¤ºå ä½å›¾æ€ä¹ˆåŠ?"></a>å¦‚æœä¸æƒ³æ˜¾ç¤ºå ä½å›¾æ€ä¹ˆåŠ?</h3><p>åœ¨å¯¹åº”çš„æ§åˆ¶å™¨å®ç°å¦‚ä¸‹æ–¹æ³•å³å¯</p><pre><code class="obj">- (NSString *)xy_noDataViewMessage {    return @&quot;&quot;;}</code></pre><h3 id="å…³äºåˆ†å‰²çº¿"><a href="#å…³äºåˆ†å‰²çº¿" class="headerlink" title="å…³äºåˆ†å‰²çº¿"></a>å…³äºåˆ†å‰²çº¿</h3><p>åœ¨æˆ‘ä¸Šé¢æåˆ°çš„é‚£ç¯‡æ–‡ç« ä¸­. åœ¨ä¿®æ”¹ backgroundView å±æ€§çš„åŒæ—¶ä¿®æ”¹äº† TableView çš„ <code>separatorStyle</code> å±æ€§, æ²¡æ•°æ®çš„æ—¶å€™å°†åˆ†å‰²çº¿å–æ¶ˆæ‰, æœ‰æ•°æ®çš„æ—¶å€™åœ¨æ·»åŠ ä¸Š, å¯æ˜¯æˆ‘åœ¨é¡¹ç›®ä¸­ä½¿ç”¨çš„ TableView çš„åˆ†å‰²çº¿ separatorStyle é£æ ¼ä¸ä¸€. æ‰€ä»¥æˆ‘æ²¡æœ‰ä¿®æ”¹åˆ†å‰²çº¿å±æ€§, å¦‚æœæƒ³è®© TableView æ²¡æœ‰æ•°æ®çš„æ—¶å€™éšè—åˆ†å‰²çº¿, å¯ä»¥çœ‹æˆ‘çš„ Demo åœ¨å¯¹åº”çš„æ§åˆ¶å™¨æ·»åŠ è¿™æ ·ä¸€è¡Œä»£ç å³å¯.</p><pre><code class="objc">    self.tableView.tableFooterView = [UIView new];</code></pre><h2 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h2><p>CollectionView åŒç†, ä»£ç å¤åˆ¶ä¸€é, å°†è·å–æ•°æ®é‡çš„åœ°æ–¹, è·å–æ¯ä¸ª Section ä¸­ Cell çš„æ•°é‡çš„ <code>numberOfRowsInSection</code> æ–¹æ³•æ”¹ä¸º <code>numberOfItemsInSection</code> å³å¯ä½¿ç”¨.</p><p>èœé¸Ÿä¸€æš, å¦‚æœæœ‰å¤§ç¥ä¸åèµæ•™, å¿…å°†æ„Ÿæ¿€ä¸å°½.</p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>æµ…æ Qt å¸ƒå±€ç³»ç»Ÿ</title>
      <link href="/2017/12/13/qt-layout/"/>
      <url>/2017/12/13/qt-layout/</url>
      <content type="html"><![CDATA[<h2 id="Qt-å¸ƒå±€ç³»ç»Ÿä»‹ç»"><a href="#Qt-å¸ƒå±€ç³»ç»Ÿä»‹ç»" class="headerlink" title="Qt å¸ƒå±€ç³»ç»Ÿä»‹ç»"></a>Qt å¸ƒå±€ç³»ç»Ÿä»‹ç»</h2><h3 id="å¸ƒå±€ç³»ç»Ÿ"><a href="#å¸ƒå±€ç³»ç»Ÿ" class="headerlink" title="å¸ƒå±€ç³»ç»Ÿ"></a>å¸ƒå±€ç³»ç»Ÿ</h3><p>ä½œä¸ºä¸€å iOS å¼€å‘äººå‘˜, è§è¯ç€ iOS å¸ƒå±€ç³»ç»Ÿçš„ä¸æ–­å®Œå–„, ä»ç»å¯¹å¸ƒå±€, Autoresizing åˆ° Autolayout. ä½¿å¾—å¼€å‘äººå‘˜çš„å·¥ä½œæ•ˆç‡è¶Šæ¥è¶Šé«˜, é¡¹ç›®ç•Œé¢çš„å¯è¯»æ€§å’Œæ˜“ç»´æŠ¤æ€§è¶Šæ¥è¶Šå¼º. å¦‚ä»Š IDE ä¸­çš„å¯è§†åŒ–ç•Œé¢å·¥å…·å·²ç»éå¸¸å¼ºå¤§, è®¸å¤šç½‘å‹â€æˆç§°â€ iOS å¼€å‘è€…ä¸ºâ€UI æ‹–æ‹½å¸ˆâ€, å¯è§, iOS å¼€å‘ä¸­ç•Œé¢å¸ƒå±€ç³»ç»Ÿçš„é«˜æ•ˆ. æ‰€ä»¥, ä¼˜ç§€çš„å¸ƒå±€ç³»ç»Ÿçš„ä½¿å‘½åœ¨äºè®©å¼€å‘è€…èŠ±æ›´å°‘çš„æ—¶é—´æ¥å®Œæˆæ›´æ˜“ç»´æŠ¤çš„ç•Œé¢. </p><p>åŒæ ·çš„, åœ¨ Qt ä¸­, ç³»ç»Ÿæä¾›äº†å¼ºå¤§çš„æ’ç‰ˆæœºåˆ¶æ¥ä¸ºçª—å£ä¸­çš„è§†å›¾è¿›è¡Œå¸ƒå±€æ’ç‰ˆ, ç»è¿‡äº†å¯¹ Qt å¸ƒå±€ä¸€ä¸ªåˆæ­¥çš„æ¢ç´¢, ä¸å¾—ä¸å¯¹ Qt å¸ƒå±€ç³»ç»Ÿçš„ç®€æ´é«˜æ•ˆè€ŒåˆåŠŸèƒ½å¼ºå¤§è¡¨ç¤ºèµå¹. </p><h4 id="å¸ƒå±€ç³»ç»Ÿçš„åŠŸèƒ½"><a href="#å¸ƒå±€ç³»ç»Ÿçš„åŠŸèƒ½" class="headerlink" title="å¸ƒå±€ç³»ç»Ÿçš„åŠŸèƒ½"></a>å¸ƒå±€ç³»ç»Ÿçš„åŠŸèƒ½</h4><p>åœ¨ Qt ä¸­, å¸ƒå±€ç³»ç»Ÿå¯ä»¥å®Œæˆ</p><ul><li>å®šä½å­æ§ä»¶</li><li>å¾—çŸ¥çª—ä½“é»˜è®¤å¤§å°</li><li>å¾—çŸ¥çª—ä½“æœ€å°å¤§å°</li><li>çª—ä½“å¤§å°å˜åŒ–æ—¶è¿›è¡Œå¸ƒå±€æ’ç‰ˆ</li><li>å†…å®¹æ”¹å˜(å­—ä½“å¤§å°æ–‡æœ¬ç­‰, éšè—æˆ–æ˜¾ç¤º, ç§»é™¤)æ—¶è¿›è¡Œå¸ƒå±€æ’ç‰ˆ</li></ul><h4 id="å¸ƒå±€ç³»ç»Ÿçš„ç»“æ„"><a href="#å¸ƒå±€ç³»ç»Ÿçš„ç»“æ„" class="headerlink" title="å¸ƒå±€ç³»ç»Ÿçš„ç»“æ„"></a>å¸ƒå±€ç³»ç»Ÿçš„ç»“æ„</h4><p>Qt æä¾›äº† QLayout ç±»åŠå…¶å­ç±»æ¥ä¸ºç•Œé¢è¿›è¡Œæ’ç‰ˆå¸ƒå±€. ç»“æ„å¦‚ä¸‹å›¾:</p><p><img src="https://user-gold-cdn.xitu.io/2017/12/13/1604db4742693550?w=640&amp;h=360&amp;f=png&amp;s=22386" alt="å¸ƒå±€ç³»ç»Ÿç»“æ„å›¾"></p><p> QLayout æ˜¯å¸ƒå±€ç³»ç»Ÿä¸­çš„æŠ½è±¡åŸºç±», ç»§æ‰¿è‡ª QObject å’Œ QLayoutItem, å…¶ä¸­å››ä¸ªå­ç±»åˆ†åˆ«ä¸º</p><ul><li>QBoxLayout(ç®±å¼å¸ƒå±€)</li><li>QFormLayout(è¡¨å•å¸ƒå±€)</li><li>QGridLayout(ç½‘æ ¼å¸ƒå±€)</li><li>QStackedLayout(æ ˆå¸ƒå±€)</li></ul><p>åœ¨çœŸå®ä½¿ç”¨åœºæ™¯ä¸­, å¾€å¾€éœ€è¦é€šè¿‡å¤šç§å¸ƒå±€çš„ç›¸ç»“åˆæ¥å®Œæˆç•Œé¢çš„è®¾è®¡, æ¥ä¸‹æ¥å°†åˆ†åˆ«ä»‹ç»å››ä¸­å¸ƒå±€.</p><h4 id="QBoxLayout-ç®±å¼å¸ƒå±€"><a href="#QBoxLayout-ç®±å¼å¸ƒå±€" class="headerlink" title="QBoxLayout ç®±å¼å¸ƒå±€"></a>QBoxLayout ç®±å¼å¸ƒå±€</h4><p>ç®±å¼å¸ƒå±€æä¾›äº†ä¸¤ä¸ªå­ç±»åˆ†åˆ«å¤„ç†æ°´å¹³(QHBoxLayout)å’Œå‚ç›´(QVBoxLayout)ä¸¤ä¸ªæ–¹å‘çš„æ’ç‰ˆ, å¯ä»¥ä½¿è§†å›¾æ’æˆä¸€è¡Œæˆ–è€…ä¸€åˆ—æ¥æ˜¾ç¤º. ç®€å•è¯´, å°±æ˜¯å¯ä»¥è®©æ§ä»¶è¿›è¡Œæ’æ’ç«™, æ¯”å¦‚åœ¨æˆ‘ä»¬çš„ AlphaBox ä¸­, é¡¶éƒ¨çš„å¤´åƒ, å§“å, å’Œåˆ·æ–°æŒ‰é’®æ’æˆäº†ä¸€æ’, è¿™å°±æ˜¯æ°´å¹³ç®±å¼å¸ƒå±€:</p><p><img src="https://user-gold-cdn.xitu.io/2017/12/13/1604db47427c71e4?w=480&amp;h=260&amp;f=png&amp;s=27839" alt="ä»€ä¹ˆå«æ’æ’ç«™"></p><p>ä½ ä»¥ä¸ºæˆ‘è¦è®²ä¸€ä¸‹è¿™ä¸ªä¸œè¥¿å¦‚ä½•å®ç°? NO, æˆ‘ååè¦ä»¥å‚ç›´ç®±å¼å¸ƒå±€ä¸ºä¾‹, ç”¨ä¸€ä¸ªæœ€ç®€å•çš„ä¾‹å­æ¥ä»‹ç»ç®±å¼å¸ƒå±€çš„ä½¿ç”¨, é¦–å…ˆåˆ›å»ºä¸€ä¸ªåŸºäº QWidget çš„ç•Œé¢, æ·»åŠ æˆ‘ä»¬éœ€è¦ä½¿ç”¨çš„å¤´æ–‡ä»¶:</p><pre><code class="cpp">#include &lt;QVBoxLayout&gt;#include &lt;QPushButton&gt;</code></pre><p>å¹¶åœ¨æ„é€ å‡½æ•°ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç </p><pre><code class="cpp">    //  æ·»åŠ ä¸¤ä¸ªæŒ‰é’®    QPushButton *okBtn  = new QPushButton;    okBtn -&gt;setText(tr(&quot;æˆ‘åœ¨ä¸Šé¢, æˆ‘æœ€ç‰›&quot;));    QPushButton *celBtn = new QPushButton;    celBtn-&gt;setText(tr(&quot;æˆ‘åœ¨ä¸‹é¢, æˆ‘ä¸æœ&quot;));    //  åˆ›å»ºä¸€ä¸ªå‚ç›´ç®±å¼å¸ƒå±€, å°†ä¸¤ä¸ªæŒ‰é’®æ‰”è¿›å»    QVBoxLayout *layout = new QVBoxLayout;    layout-&gt;addWidget(okBtn);    layout-&gt;addWidget(celBtn);    //  è®¾ç½®ç•Œé¢çš„å¸ƒå±€ä¸ºå‚ç›´ç®±å¼å¸ƒå±€    setLayout(layout);</code></pre><p>è¿è¡Œçœ‹ä¸€ä¸‹æ•ˆæœ, ä»€ä¹ˆ? è¿™å°±å¯ä»¥è¿è¡Œäº†? åæ ‡å‘¢? å°ºå¯¸å‘¢? æ˜¯çš„, æ²¡çœ‹é”™â€¦ç‚¹å‡»è¿è¡Œ:</p><p><img src="https://user-gold-cdn.xitu.io/2017/12/13/1604db4742a9c721?w=480&amp;h=268&amp;f=png&amp;s=30417" alt="æœ€ç®€å•çš„ç®±å¼å¸ƒå±€"></p><p>ä¸¤ä¸ªæŒ‰é’®å·²ç»ä¸€ä¸Šä¸€ä¸‹, ä¹–ä¹–çš„åœ¨å‚ç›´æ–¹å‘è‡ªå·±ç«™å¥½äº†ä½ç½®, å°±æ˜¯è¿™ä¹ˆå¼ºå¤§, å°±æ˜¯è¿™ä¹ˆçœå¿ƒ.</p><h4 id="QFormLayout-è¡¨å•å¸ƒå±€"><a href="#QFormLayout-è¡¨å•å¸ƒå±€" class="headerlink" title="QFormLayout è¡¨å•å¸ƒå±€"></a>QFormLayout è¡¨å•å¸ƒå±€</h4><p>å¼ºå¤§çš„ AlphaBox æ˜¯å¾ˆå¤–å‘çš„, å¯ä»¥å¾ˆè½»æ¾çš„å°†ä½ çš„èµ„æ–™åˆ†äº«ç»™å…¶ä»–ç”¨æˆ·, å½“æˆ‘ä»¬åˆ†äº«çš„æ—¶å€™, ä¼šæœ‰è¿™æ ·ä¸€ä¸ªç•Œé¢:</p><p><img src="https://user-gold-cdn.xitu.io/2017/12/13/1604db474299f9a3?w=480&amp;h=232&amp;f=png&amp;s=20804" alt="åœ¨ AlphaBox ä¸­å…±äº«èµ„æ–™"></p><p>çœ‹åˆ°è¿™ä¸ªç•Œé¢, èªæ˜çš„ä½ å¯èƒ½ä¼šè¯´, è¿™å¾ˆç®€å•å•Š, å¥½å‡ ä¸ªæ°´å¹³ç®±å¼å¸ƒå±€å°±å¯ä»¥å®ç°, å¯æ˜¯, æ›´èªæ˜çš„ Qt æä¾›äº†æ›´é«˜æ•ˆçš„æ–¹å¼å¸®åŠ©ä½ å®Œæˆè¿™æ ·ä¸€ä¸ªç•Œé¢, é‚£å°±æ˜¯ QFormLayout.</p><p>åœ¨æˆ‘æ‰€å­¦ä¹  Qt æ‰€ä½¿ç”¨çš„ä¹¦ç±ä¸­, å°† QFormLayout ç¿»è¯‘ä¸ºçª—ä½“å¸ƒå±€, æˆ‘ä¸ªäººè®¤ä¸º, å°†å…¶ç¿»è¯‘ä¸ºè¡¨å•å¸ƒå±€æ›´ä¸ºè´´åˆ‡, å› ä¸º QFormLayout çš„å¼ºå¤§ä¹‹å¤„æ­£æ˜¯å¯ä»¥ä½¿ç”¨æœ€å¿«çš„é€Ÿåº¦å®Œæˆä¸€ä¸ªç”¨æˆ·è¾“å…¥çš„è¡¨å•ç•Œé¢çš„æ­å»º.</p><p>é‚£ä¹ˆ, è®©æˆ‘ä»¬æ­å¼€ AlphaBox çš„ç¥ç§˜é¢çº±, çœ‹çœ‹è¿™æ ·ä¸€ä¸ªç•Œé¢æ˜¯æ€ä¹ˆå®ç°çš„.</p><p>é¦–å…ˆ, æ‹–æ‹½ä¸€ä¸ª Form Layout åˆ° Widget ä¸­.</p><p><img src="https://user-gold-cdn.xitu.io/2017/12/13/1604db474545565c?w=480&amp;h=205&amp;f=jpeg&amp;s=11896" alt="æ·»åŠ è¡¨å•å¸ƒå±€"></p><p>åŒå‡»ä¹‹åå³å¯ä¸ºè¡¨å•å¢åŠ ä¸€è¡Œ.</p><p><img src="https://user-gold-cdn.xitu.io/2017/12/13/1604db4745517544?w=480&amp;h=478&amp;f=png&amp;s=50895" alt="ä¸ºè¡¨å•å¢åŠ ä¸€è¡Œ"></p><p>ç›¸ä¿¡å¤§å®¶çœ‹åˆ°è¿™å¼ å›¾æ—¶, å°±å·²ç»èƒ½ç†è§£åˆ°è¡¨å•å¸ƒå±€æ˜¯å¦‚ä½•ä½¿ç”¨çš„, æä¾›äº†æ ‡ç­¾ä½œä¸ºç”¨æˆ·è¾“å…¥å†…å®¹çš„æŒ‡å¼•, æä¾›å­—æ®µç±»å‹ä½œä¸ºç”¨æˆ·è¾“å…¥çš„æ§ä»¶, ä½œä¸º iOS å¼€å‘è€…, æ·±çŸ¥è¿™æ ·ä¸€ä¸ªç•Œé¢çš„æ­å»ºæ‰€éœ€è¦çš„ç¹æ‚çš„å·¥ä½œé‡. å½“æˆ‘ç¬¬ä¸€æ¬¡æ‰“å¼€è¿™ä¸ªç•Œé¢æ—¶, è¢«è¿™æ ·åˆ›å»ºç•Œé¢çš„æ–¹å¼æ‰€æƒŠå‘†äº†. </p><ol><li>æŒ‰ç…§å›¾ä¸­, åˆ›å»ºè¡¨å•çš„ç¬¬ä¸€è¡Œ, å…±äº«ç»™å“ªä¸ªç”¨æˆ·çš„è¾“å…¥æ¡†, å¯ä»¥ä¸ºè¾“å…¥æ¡†å¡«å†™å ä½æ–‡å­—.</li><li>åŒå‡» Form Layout åˆ›å»ºå­—æ®µç±»å‹ä¸º QComboBox (å¤šé€‰æ¡†)çš„ä¸€è¡Œ. å¡«å†™å…è®¸çš„æƒé™å†…å®¹.</li><li>è®¾ç½®æ•´ä¸ª Widget å¸ƒå±€ä¸ºå‚ç›´ç®±å¼å¸ƒå±€</li><li>åœ¨ Form Layout ä¸‹æ‹–æ‹½è¿‡å»ä¸€ä¸ª Horizontal Layout(æ°´å¹³ç®±å¼å¸ƒå±€)</li><li>åœ¨ç®±å¼å¸ƒå±€ä¸­æ·»åŠ  Horizontal Spacer (æ°´å¹³å ä½) åæ‹–æ‹½ä¸¤ä¸ª Push Button å®Œæˆç•Œé¢å¸ƒå±€</li></ol><p><img src="https://user-gold-cdn.xitu.io/2017/12/13/1604db47738ff342?w=480&amp;h=165&amp;f=jpeg&amp;s=12866" alt="å…±äº«ç•Œé¢çš„å¸ƒå±€"></p><p>å¿«ä¸å¿«? å¿«ä¸å¿«! å¿«ä¸å¿«!!!</p><p>åŒæ ·çš„, å¦‚æœæ˜¯ä½¿ç”¨çº¯ä»£ç è¡¨å•å¸ƒå±€çš„è¯å¯ä»¥ä½¿ç”¨<code>addRow()</code>çš„æ–¹æ³•æ¥æ·»åŠ ä¸€è¡Œ.</p><h4 id="QGridLayout-ç½‘æ ¼å¸ƒå±€"><a href="#QGridLayout-ç½‘æ ¼å¸ƒå±€" class="headerlink" title="QGridLayout ç½‘æ ¼å¸ƒå±€"></a>QGridLayout ç½‘æ ¼å¸ƒå±€</h4><p><img src="https://user-gold-cdn.xitu.io/2017/12/13/1604db477397fa8f?w=480&amp;h=349&amp;f=png&amp;s=20575" alt="å¼ºå¤§çš„ AlphaBox æ˜¯è¿™æ ·çš„"></p><p>äº‹å®ä¸Š, å¼ºå¤§çš„ AlphaBox æ˜¯è¿™æ ·çš„, æˆ‘ä»¬å¯ä»¥å…±äº«ç»™å¤šä¸ªç”¨æˆ·, è€Œä¸”, ä¸‹æ–¹ä¼šæœ‰ä¸€ä¸ªåˆ—è¡¨, å±•ç¤ºå…±äº«çš„ç”¨æˆ·ä»¥åŠæƒé™åˆ—è¡¨. è¿™æ—¶, è¡¨å•å¸ƒå±€å°±æ²¡åŠæ³•æ»¡è¶³æˆ‘ä»¬, åªå¥½å¦æ±‚æ–°æ¬¢ QGridLayout - ç½‘æ ¼å¸ƒå±€.</p><p>ç½‘æ ¼å¸ƒå±€é¡¾åæ€ä¹‰, å¯ä»¥å°†ç•Œé¢åˆ†å‰²æˆè¡Œåˆ—æ¥è¿›è¡Œå¸ƒå±€ç®¡ç†, åœ¨æ¯ä¸ªå•å…ƒæ ¼ä¸­æ¥æ‘†æ”¾æ§ä»¶. æ‰€ä»¥ AlphaBox åˆ†äº«çš„ç•Œé¢ä½¿ç”¨äº†ä¸€ä¸ª <strong>ä¸¤è¡Œä¸‰åˆ—</strong> çš„ç½‘æ ¼å¸ƒå±€æ¥å®ç°çš„.</p><p><img src="https://user-gold-cdn.xitu.io/2017/12/13/1604db4778649978?w=480&amp;h=85&amp;f=jpeg&amp;s=7669" alt="QGridLayout - ç½‘æ ¼å¸ƒå±€"></p><p>å½“ç„¶, æ›´æ›´å¤æ‚çš„ç•Œé¢, ç”¨ Qt å¸ƒå±€çš„æ•ˆç‡ä¹Ÿæ˜¯éå¸¸é«˜çš„, æˆ‘åšäº†ä¸€ä¸ªå¤–é“¾åˆ†äº«çš„å¸ƒå±€ Demo, å¯ä»¥å°†å†…éƒ¨èµ„æ–™ç”Ÿæˆä¸€ä¸ªä¸‹è½½é“¾æ¥å…±äº«ç»™ä»»ä½•äººå»ä¸‹è½½.</p><p><img src="https://user-gold-cdn.xitu.io/2017/12/13/1604db47787dc959?w=480&amp;h=357&amp;f=png&amp;s=31610" alt="å¤–é“¾åˆ†äº«ç•Œé¢"></p><p>è¿™ä¸ªç•Œé¢ä¸­, æˆ‘åœ¨Tabä¹‹å†…ä½¿ç”¨äº†ç½‘æ ¼å¸ƒå±€, å¸ƒå±€å¦‚å›¾:</p><p><img src="https://user-gold-cdn.xitu.io/2017/12/13/1604db477dd43f8c?w=480&amp;h=320&amp;f=jpeg&amp;s=19381" alt="å¤–é“¾åˆ†äº«ç•Œé¢å¸ƒå±€"></p><p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡º, ç½‘æ ¼å¸ƒå±€åƒæ˜¯åœ¨æ“ä½œä¸€ä¸ª Excel ä¸€æ ·ç®€å•, å¸ƒå±€å•å…ƒæ ¼, åˆå¹¶å•å…ƒæ ¼, ç­‰ç­‰.</p><p>åœ¨è¿™ä¸ªç•Œé¢ä¸­, æ›´çµæ´»çš„ä½¿ç”¨äº† QLayout çš„å±æ€§æ¥å®Œæˆäº†ç•Œé¢å¸ƒå±€æ’ç‰ˆ.</p><p>åŒæ ·çš„, åœ¨ä»£ç ä¸­, å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ç­‰çš„ Api æ¥ä¸ºç½‘æ ¼è§†å›¾æ·»åŠ ä¸€ä¸ªä»å‡ è¡Œå‡ åˆ—å¼€å§‹å æ®å‡ è¡Œå‡ åˆ—çš„æ§ä»¶:</p><pre><code class="cpp">void addWidget(QWidget *, int row, int column, int rowSpan, int columnSpan)</code></pre><h4 id="QStackedLayout-æ ˆå¸ƒå±€"><a href="#QStackedLayout-æ ˆå¸ƒå±€" class="headerlink" title="QStackedLayout æ ˆå¸ƒå±€"></a>QStackedLayout æ ˆå¸ƒå±€</h4><p>å¦‚åœ¨ AlphaBox ä¸­, æˆ‘ä»¬å¯ä»¥é€šè¿‡äº‘ç«¯æ–‡ä»¶æµè§ˆå™¨ç›´æ¥æŸ¥çœ‹å’Œæ“ä½œäº‘ç«¯æ–‡ä»¶, åœ¨åŠ è½½çš„è¿‡ç¨‹ä¸­, ä¼šæœ‰ä¸€ä¸ªè½¬èŠèŠ±çš„ç•Œé¢.</p><p><img src="https://user-gold-cdn.xitu.io/2017/12/13/1604db478e91a5a1?w=480&amp;h=377&amp;f=png&amp;s=12861" alt="åœ¨è½¬èŠèŠ±çš„ AlphaBox"></p><p>åŠ è½½å¤±è´¥æ—¶çš„é”™è¯¯æç¤º:</p><p><img src="https://user-gold-cdn.xitu.io/2017/12/13/1604db4794309c91?w=480&amp;h=377&amp;f=png&amp;s=15651" alt="èŠèŠ±è½¬å¤±è´¥äº†çš„ AlphaBox"></p><p>ä»¥åŠåŠ è½½æˆåŠŸæ—¶:</p><p><img src="https://user-gold-cdn.xitu.io/2017/12/13/1604db4799cf96cf?w=480&amp;h=377&amp;f=png&amp;s=25245" alt="é€šå¸¸æƒ…å†µä¸‹æˆ‘ä»¬èƒ½çœ‹è§çš„ AlphaBox"></p><p>é€šå¸¸åº”ç”¨çš„ç•Œé¢ä¼šæ ¹æ®ä¸åŒçš„çŠ¶æ€æœ‰ä¸åŒçš„å†…å®¹, è¿™æ—¶å°±å¯ä»¥ä½¿ç”¨ QStackedLayout æ ˆå¸ƒå±€, æ ˆå¸ƒå±€æä¾›äº†ä¸€ä¸ªé¡µé¢çš„æ ˆ, æ¯ä¸ªé¡µé¢æœ‰å®Œå…¨ç‹¬ç«‹çš„ç•Œé¢å¸ƒå±€. å¯ä»¥éå¸¸æ¸…æ™°çš„å¯¹ä¸åŒçŠ¶æ€ä¸‹çš„ç•Œé¢è¿›è¡Œå¸ƒå±€ç®¡ç†.</p><p>åœ¨ Qt çš„å¯è§†åŒ–å¸ƒå±€å·¥å…·ä¸­, é€šè¿‡ Stacked Widget æ¥å®Œæˆç•Œé¢çš„æ ˆå¸ƒå±€</p><p><img src="https://user-gold-cdn.xitu.io/2017/12/13/1604db479df25bf5?w=320&amp;h=289&amp;f=jpeg&amp;s=12895" alt="Stacked Widget"></p><p>é€šè¿‡å³é”®æ¥è¿›è¡Œé¡µé¢çš„æ’å…¥ç§»é™¤å’Œæ’åºç­‰æ“ä½œ.</p><h3 id="å¸ƒå±€ç›¸å…³å±æ€§"><a href="#å¸ƒå±€ç›¸å…³å±æ€§" class="headerlink" title="å¸ƒå±€ç›¸å…³å±æ€§"></a>å¸ƒå±€ç›¸å…³å±æ€§</h3><h4 id="æ§ä»¶å¤§å°"><a href="#æ§ä»¶å¤§å°" class="headerlink" title="æ§ä»¶å¤§å°"></a>æ§ä»¶å¤§å°</h4><p>å¯¹äºæ§ä»¶å¤§å°, æœ€é‡è¦çš„ä¸¤ä¸ªå±æ€§æ˜¯ <code>sizeHint</code> å’Œ <code>minimumSizeHint</code> , è¿™æ˜¯ QWidget çš„å±æ€§, æ˜¯åªè¯»å±æ€§. å…¶ä¸­, <code>sizeHint</code> å±æ€§ä¸ºæ§ä»¶çš„å»ºè®®å¤§å°, å¯¹äºä¸åŒçš„æ§ä»¶, æœ‰ä¸åŒçš„å»ºè®®å¤§å°, åŒç† <code>minimumSizeHint</code> ä¸ºå»ºè®®çš„æœ€å°å¤§å°. çŸ¥é“äº†è¿™ä¸¤ä¸ªå±æ€§æ‰å¯ä»¥ç†è§£å¸ƒå±€ä¸­æ§ä»¶çš„å¤§å°æ˜¯å¦‚ä½•æ§åˆ¶çš„. å¦‚æœæ‰‹åŠ¨è®¾ç½®äº†æœ€å°å°ºå¯¸çš„è¯(<code>minimumSize</code>), <code>minimumSizeHint</code> æ˜¯ä¼šè¢«å¿½ç•¥çš„.</p><h4 id="å¤§å°ç­–ç•¥"><a href="#å¤§å°ç­–ç•¥" class="headerlink" title="å¤§å°ç­–ç•¥"></a>å¤§å°ç­–ç•¥</h4><p>å¤§å°ç­–ç•¥å±æ€§ <code>sizePolicy</code> ä¹Ÿæ˜¯ QWidget ç±»çš„å±æ€§, è¿™ä¸ªå±æ€§åœ¨æ°´å¹³å’Œå‚ç›´ä¸¤ä¸ªæ–¹å‘åˆ†åˆ«èµ·ä½œç”¨, æ§åˆ¶ç€æ§ä»¶å¤§å°å˜åŒ–çš„ç­–ç•¥.</p><p>åœ¨å¯è§†åŒ–å·¥å…·ä¸­å¯ä»¥ç›´è§‚çš„çœ‹åˆ°å‡ ç§å¤§å°ç­–ç•¥, ä»¥å‚ç›´ä¸ºä¾‹å¦‚å›¾:</p><p><img src="https://user-gold-cdn.xitu.io/2017/12/13/1604db479dd52506?w=530&amp;h=292&amp;f=jpeg&amp;s=23280" alt="å¤§å°ç­–ç•¥"></p><ul><li><code>QSizePolicy::Fixed</code> åªèƒ½ä½¿ç”¨ sizeHint çš„å¤§å°, ä»»ä½•æ“ä½œéƒ½ä¸ä¼šæ”¹å˜æ§ä»¶å¤§å°</li><li><code>QSizePolicy::Minimum</code> sizeHint ä¸ºæœ€å°å¤§å°, æ§ä»¶å¯ä»¥è¢«æ‹‰ä¼¸</li><li><code>QSizePolicy::Maximum</code> sizeHint ä¸ºæœ€å¤§å¤§å°, æ§ä»¶å¯ä»¥è¢«å‹ç¼©</li><li><code>QSizePolicy::Preferred</code> sizeHint ä¸ºå»ºè®®å¤§å°, æ§ä»¶æ—¢å¯ä»¥è¢«å‹ç¼©ä¹Ÿå¯ä»¥è¢«æ‹‰ä¼¸</li><li><code>QSizePolicy::MinimumExpanding</code> sizeHint ä¸ºæœ€å°å¤§å°, ä¸èƒ½è¢«å‹ç¼©, è¢«æ‹‰ä¼¸çš„ä¼˜å…ˆçº§æ›´é«˜</li><li><code>QSizePolicy::Expanding</code> sizeHint ä¸ºå»ºè®®å¤§å°, å¯ä»¥è¢«å‹ç¼©, è¢«æ‹‰ä¼¸çš„ä¼˜å…ˆçº§æ›´é«˜</li><li><code>QSizePolicy::Ignored</code> sizeHint çš„å€¼å°†ä¼šè¢«å¿½ç•¥</li></ul><p>åœ¨ç½‘ä¸Šæˆ–è€…ä¹¦ä¸­, å…³äºè¿™äº›ç­–ç•¥çš„è¯´æ˜ä¼šæœ‰å¾ˆå¤š, å¯æ˜¯å¦‚æœä¸æ˜¯çœŸçš„è‡ªå·±å°è¯•ä¸€ä¸‹, å¾ˆéš¾å¾ˆå¥½çš„ç†è§£åœ¨å¤æ‚å¸ƒå±€çš„æƒ…å†µä¸‹, å¤§å°ç­–ç•¥æ˜¯å¦‚ä½•æ§åˆ¶å¸ƒå±€çš„, å°¤å…¶æ˜¯ <code>MinimumExpanding</code>, <code>Expanding</code>, <code>Ignored</code> è¿™ä¸‰ç§. </p><p>å¯¹äºä¼˜å…ˆçº§çš„æ¦‚å¿µå¤§å®¶è‚¯å®šä¸ä¼šé™Œç”Ÿ, è¿™é‡Œæˆ‘è®¤ä¸ºä¼˜å…ˆçº§æ¥è§£é‡Šè¿™äº›ç­–ç•¥æ˜¯æ›´æ¸…æ™°æ˜“æ‡‚çš„.</p><p>å…³äº<strong>æ‹‰ä¼¸</strong> <code>Expanding</code> , <code>MinimumExpanding</code> ä¼˜å…ˆçº§ç›¸åŒ, åŒæ—¶è¦æ¯” <code>Preferred</code> å’Œ <code>Ignored</code> æ‹‰ä¼¸ä¼˜å…ˆçº§æ›´é«˜, <code>Preferred</code> å’Œ <code>Ignored</code> ç›¸åŒ.</p><p> æ¢å¥è¯è¯´, å¦‚æœä¸¤ä¸ªæ§ä»¶åœ¨ä¸€ä¸ªæ°´å¹³ç®±å¼å¸ƒå±€ä¸­ç®¡ç†, å…¶ä¸­ä¸€ä¸ªæ°´å¹³å¤§å°ç­–ç•¥ä¸º <code>Preferred</code> å¦ä¸€ä¸ªä¸º <code>Expanding</code> æˆ–è€… <code>MinimumExpanding</code> å¦‚æœæ°´å¹³æ‹‰ä¼¸çª—ä½“, åˆ™ <code>Preferred</code>çš„æ§ä»¶å¤§å°ä¸ä¼šæ”¹å˜, <code>Expanding</code> æˆ–è€…æ˜¯ <code>MinimumExpanding</code> ä¼šè¢«æ‹‰ä¼¸.</p><p>åŒç†, å¦‚æœä¸¤ä¸ªæ§ä»¶æ°´å¹³å¤§å°ç­–ç•¥ä¸€ä¸ªä¸º<code>Expanding</code>, ä¸€ä¸ªæ˜¯<code>MinimumExpanding</code>, è¿™æ—¶æ‹‰ä¼¸çª—ä½“, åˆ™ä¸¤ä¸ªæ§ä»¶å‡ä¼šæ‹‰ä¼¸.</p><p>å¤šè¯´ä¸€å¥, å¦‚æœä¸¤ä¸ªæ§ä»¶éƒ½ä¸º <code>Fixed</code> æ— æ³•æ‹‰ä¼¸æ—¶, æ§ä»¶é—´çš„é—´éš™ä¼šè¢«æ‹‰ä¼¸.</p><p>å…³äº<strong>å‹ç¼©</strong> å¦‚æœè¾¾åˆ°äº†<code>minimumSizeHint</code>æ˜¯ä¸ä¼šè¢«ç»§ç»­å‹ç¼©äº†, ä½†æ˜¯<code>Ignored</code>æ˜¯ä¼šå¿½ç•¥ <code>sizeHint</code> å’Œ <code>minimumSizeHint</code> çš„å±æ€§çš„, æ‰€ä»¥æ˜¯ä¼šç»§ç»­è¢«å‹ç¼©çš„.</p><h4 id="ä¼¸ç¼©æ€§"><a href="#ä¼¸ç¼©æ€§" class="headerlink" title="ä¼¸ç¼©æ€§"></a>ä¼¸ç¼©æ€§</h4><p>åœ¨ QLayout ä¸­æä¾›äº†ä¸€ä¸ªå’Œæ§ä»¶å¤§å°ç­–ç•¥ç›¸å…³çš„å±æ€§, <code>layoutStretch</code> å¸ƒå±€ä¼¸ç¼©æ€§, è¿™ä¸ªå€¼æ˜¯ä¸€ä¸ªæ¯”ä¾‹, åœ¨å¯è§†åŒ–å·¥å…·ä¸­å¯ä»¥æ›´ç›´è§‚çš„çœ‹åˆ°è¿™ä¸ªå€¼çš„è®¾ç½®, å¦‚æœåœ¨å¸ƒå±€ä¸­æœ‰ä¸‰ä¸ªæ§ä»¶, åˆ™æ˜¯ä¸‰ä¸ªæ§ä»¶çš„å æ¯”, ç”¨é€—å·åˆ†éš”, å¦‚: <code>1, 1, 1</code> .</p><p>ä¼¸ç¼©æ€§å°±å¥½ç†è§£ä¸€äº›äº†, ä½†æ˜¯è¦æ³¨æ„çš„æ˜¯, åªæœ‰<strong>ä¼šè¢«å‹ç¼©æˆ–è€…æ‹‰ä¼¸</strong>çš„æ§ä»¶æ‰ä¼šå—è¯¥å±æ€§å€¼å½±å“(å¦‚ <code>Fixed</code> æ˜¯ä¸ä¼šå—è¯¥å±æ€§å½±å“)</p><p> è¿˜æœ‰ä¸€ç‚¹éå¸¸é‡è¦çš„æ˜¯è®¾ç½®äº†ä¼¸ç¼©æ€§çš„æ¯”å€¼(å¦‚æœéƒ½ä¸º0, åˆ™è¡¨ç¤ºä¸è®¾ç½®) åˆšåˆšæåˆ°çš„<strong>å¤§å°ç­–ç•¥çš„ä¼˜å…ˆçº§å°†ä¼šè¢«å¿½ç•¥</strong>, è¿˜æ˜¯åˆšåˆšçš„ä¾‹å­, å¦‚æœä¸¤ä¸ªæ§ä»¶åœ¨ä¸€ä¸ªæ°´å¹³ç®±å¼å¸ƒå±€ä¸­ç®¡ç†, å…¶ä¸­ä¸€ä¸ªæ°´å¹³å¤§å°ç­–ç•¥ä¸º <code>Preferred</code> å¦ä¸€ä¸ªä¸º <code>Expanding</code>, è®¾ç½®æ°´å¹³ç®±å¼å¸ƒå±€çš„ <code>layoutStretch</code> ä¸º <code>2, 1</code> åˆ™æ‹‰ä¼¸æ—¶, å¹¶ä¸ä¼šåƒåˆšåˆšæ‰€è¯´, åªæœ‰ <code>Expanding</code> çš„æ§ä»¶ä¼šè¢«æ‹‰ä¼¸, è€Œæ˜¯éƒ½ä¼šè¢«æ‹‰ä¼¸, æŒ‰ç…§ä¸€ä¸ª 2 : 1 çš„æ‹‰ä¼¸æ¯”ä¾‹æ‹‰ä¼¸.</p><h4 id="çª—ä½“å¤§å°çº¦æŸç­–ç•¥"><a href="#çª—ä½“å¤§å°çº¦æŸç­–ç•¥" class="headerlink" title="çª—ä½“å¤§å°çº¦æŸç­–ç•¥"></a>çª—ä½“å¤§å°çº¦æŸç­–ç•¥</h4><p>æœ€åæƒ³ä»‹ç»ä¸€ä¸‹ QLayout çš„ <code>layoutSizeConstraint</code> å±æ€§, ç”¨æ¥çº¦æŸçª—ä½“å¤§å°,  åªå½±å“çª—ä½“, æ‰€ä»¥<strong>è¯¥å±æ€§åªå¯¹æœ€é¡¶çº§çš„ QLayout èµ·ä½œç”¨</strong>.</p><p> <img src="https://user-gold-cdn.xitu.io/2017/12/13/1604db479dfbd358?w=320&amp;h=678&amp;f=jpeg&amp;s=42338" alt="layoutSizeConstraint"></p><p>å…³äºè¿™å‡ ä¸ªå±æ€§åŒæ ·çš„, ç®€å•çš„ä»‹ç»ç½‘ä¸Šå’Œä¹¦ä¸Šä¼šæœ‰å¾ˆå¤š, å¦‚æœä¸å°è¯•ä¸€ä¸‹, æµ…æ˜¾çš„å­—é¢æ„æ€æ— æ³•ç†è§£è¿™å‡ ä¸ªå±æ€§çš„ä½œç”¨. æ ¹æ®æˆ‘çš„å°è¯•, æ€»ç»“å¦‚ä¸‹:</p><ul><li><code>QLayout::SetDefaultConstraint</code> çª—ä½“æœ€å°å€¼è¢«è®¾ç½®ä¸º minimumSize å€¼æ— æ³•å†ç¼©å°, <strong>å¦‚æœ QLayout å†…æ§ä»¶æœ‰æ›´å¤§çš„minimumSize, åˆ™ä¼šå–æ›´å¤§çš„minimumSize.</strong></li><li><code>QLayout::SetNoConstraint</code> çª—ä½“æ²¡æœ‰çº¦æŸç­–ç•¥</li><li><code>QLayout::SetFixedSize</code>ï¼Œçª—ä½“å¤§å°è¢«è®¾å®šä¸º sizeHint çš„å¤§å°ï¼Œæ— æ³•æ”¹å˜</li><li><code>QLayout::SetMinimumSize</code> çª—ä½“æœ€å°ä¸º minimumSize æ— æ³•å†ç¼©å°, <strong>å¦‚æœ QLayout å†…æ§ä»¶æœ‰æ›´å°çš„minimumSize, åˆ™ä¼šå–æ›´å°çš„minimumSize.</strong>, æ€»ç»“å°±æ˜¯çš„è¯, å’Œ Default ä¸åŒçš„åœ°æ–¹å°±æ˜¯å°½å¯èƒ½çš„å°.</li><li><code>QLayout::SetMaxmumSize</code> åŒç†, çª—ä½“æœ€å¤§å€¼ä¸º maxmumSize , æ— æ³•å†æ”¾å¤§</li><li><code>QLayout::SetMinAndMaxSize</code> çª—ä½“æœ€å°ä¸º minimumSize æ— æ³•å†ç¼©å°, çª—ä½“æœ€å¤§å€¼ä¸º maxmumSize , æ— æ³•å†æ”¾å¤§</li></ul><h4 id="å…¶ä»–å±æ€§"><a href="#å…¶ä»–å±æ€§" class="headerlink" title="å…¶ä»–å±æ€§"></a>å…¶ä»–å±æ€§</h4><p>å…³äºè¡¨å•å¸ƒå±€å’Œç½‘æ ¼å¸ƒå±€è¿˜æœ‰å…¶ä»–çš„å±æ€§çº¦æŸå•å…ƒæ ¼çš„ä¸€äº›ç­–ç•¥, å¦‚ <code>layoutFieldGrowthPolicy</code> æ§ä»¶çš„å˜åŒ–æ–¹å¼ç­–ç•¥ç­‰ç­‰æœ‰å…´è¶£å¯ä»¥æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£, æ›´å¤šçš„å±æ€§é—´éš™, é—´éš”, å¯¹å…¶æ–¹å¼ç­‰ç­‰éƒ½æ¯”è¾ƒå¥½ç†è§£äº†, åœ¨æ­¤ä¹Ÿä¸èµ˜è¿°äº†.</p><h4 id="å®˜æ–¹æ–‡æ¡£"><a href="#å®˜æ–¹æ–‡æ¡£" class="headerlink" title="å®˜æ–¹æ–‡æ¡£"></a>å®˜æ–¹æ–‡æ¡£</h4><p><a href="http://doc.qt.io" target="_blank" rel="noopener"> Qt å®˜æ–¹æ–‡æ¡£ç‚¹è¿™é‡Œ</a></p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><blockquote><p>&lt;&lt; Qt Creator å¿«é€Ÿå…¥é—¨&gt;&gt; ç¬¬ä¸‰ç‰ˆ, éœäºšé£è‘—</p></blockquote>]]></content>
      
      
    </entry>
    
  
  
</search>
